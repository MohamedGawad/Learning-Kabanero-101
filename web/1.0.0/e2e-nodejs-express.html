<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>End to End Node.js Express CP4Apps workflow :: Learning CP4Apps Accelerators for Teams 101</title>
    <link rel="canonical" href="https://github.com/ibm-cloud-architecture/Learning-Kabanero-101/web/1.0.0/e2e-nodejs-express.html">
    <meta name="generator" content="Antora 2.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-149377589-1"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','UA-149377589-1')</script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <p>CP4Apps Accelerators for Teams 101</p>
      </div>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="web" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="kabanero-overview.html">Learning CP4Apps Accelerators for Teams</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="kabanero-overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installing Kabanero Enterprise</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://cloud.ibm.com/catalog/content/ibm-cp-applications" target="_blank" rel="noopener">Using IBM Cloud Console ↗</a></span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://www.ibm.com/support/knowledgecenter/en/SSCSJL_4.1.x/install-icpa-cli.html" target="_blank" rel="noopener">OCP4 CLI Installer ↗</a></span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://www.ibm.com/support/knowledgecenter/en/SSCSJL/install-icpa-cli.html" target="_blank" rel="noopener">OCP3 CLI Installer ↗</a></span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Workflows</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="e2e-java-spring-boot2.html">E2E Java Spring Boot 2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="e2e-java-openliberty.html">E2E Java OpenLiberty</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="e2e-nodejs-express.html">E2E Node.js Express</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tasks</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="appsody-deploy.html">Appsody Deploy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="codewind-setup-appsody.html">Configure CodeWind</a>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://www.ibm.com/support/knowledgecenter/SSCSJL_4.1.x/guides/guide-working-with-stacks/README.html" target="_blank" rel="noopener">Customizing Application Stacks ↗</a></span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://www.ibm.com/support/knowledgecenter/SSCSJL_4.1.x/guides/guide-curating-pipelines/curating.html" target="_blank" rel="noopener">Creating and updating tasks and pipelines ↗</a></span>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tekton-credentials-github.html">Configure Github Credentials</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tekton-credentials-docker.html">Configure Docker Credentials</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">External Resources</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://developer.ibm.com/technologies/containers/tutorials/create-appsody-stack" target="_blank" rel="noopener">Create Appsody Stack ↗</a></span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://github.com/gcharters/kabanero-dev-getting-started" target="_blank" rel="noopener">Java MicroProfile Tutorial ↗</a></span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://developer.ibm.com/components/cloud-pak-for-applications" target="_blank" rel="noopener">IBM Cloud Pak for Applications @ IBM Developer ↗</a></span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="references.html">References</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Learning CP4Apps Accelerators for Teams</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Learning CP4Apps Accelerators for Teams</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="kabanero-overview.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="kabanero-overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="kabanero-overview.html">Learning CP4Apps Accelerators for Teams</a></li>
    <li>Workflows</li>
    <li><a href="e2e-nodejs-express.html">E2E Node.js Express</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/ibm-cloud-architecture/Learning-Kabanero-101/edit/master/modules/ROOT/pages/e2e-nodejs-express.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">End to End Node.js Express CP4Apps workflow</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_prerequisites">Prerequisites</a></li>
<li><a href="#_add_stacks_to_appsody">Add Stacks to appsody</a></li>
<li><a href="#_appsody_application">Appsody application</a>
<ul class="sectlevel2">
<li><a href="#_create_a_new_application">Create a new Application</a></li>
<li><a href="#_build_the_application">Build the application</a></li>
<li><a href="#_test_the_application">Test the Application</a></li>
<li><a href="#_run_the_application">Run the Application</a></li>
<li><a href="#_stop_the_application">Stop the Application</a></li>
<li><a href="#_debug_the_application">Debug the Application</a></li>
</ul>
</li>
<li><a href="#_appsody_tasks_on_vs_code">Appsody tasks on VS Code</a></li>
<li><a href="#_codewind_on_vs_code">Codewind on VS Code</a>
<ul class="sectlevel2">
<li><a href="#_getting_the_codewind_extension">Getting the Codewind extension</a></li>
<li><a href="#_adding_the_application">Adding the application</a></li>
<li><a href="#_project_options">Project Options</a></li>
<li><a href="#_application_performance_monitor_profiling_with_codewind">Application Performance, Monitor, Profiling with Codewind</a></li>
</ul>
</li>
<li><a href="#_deploy_the_appsody_application_on_openshift_for_team_development">Deploy the appsody application on Openshift for team development</a>
<ul class="sectlevel2">
<li><a href="#_set_up_team_project_namespace">Set up team project namespace</a></li>
<li><a href="#_add_new_target_namespace">Add new Target Namespace</a></li>
<li><a href="#_create_application_deployment_manifest">Create application deployment manifest</a></li>
<li><a href="#_creating_a_git_repo">Creating a git repo</a></li>
<li><a href="#_create_an_access_token">Create an access token</a></li>
</ul>
</li>
<li><a href="#_configure_the_devops_pipeline">Configure the DevOps Pipeline</a>
<ul class="sectlevel2">
<li><a href="#_accessing_tekton_dashboard">Accessing Tekton dashboard</a></li>
<li><a href="#_create_tekton_webhook_for_git_repo">Create Tekton webhook for git repo</a></li>
<li><a href="#_set_up_the_pipeline">Set up the pipeline</a></li>
<li><a href="#_deploy_the_application">Deploy the Application</a></li>
</ul>
</li>
<li><a href="#_ocp_4_x_instructions">OCP 4.X instructions</a></li>
<li><a href="#_serverless_autoscaling_the_application_with_knative">Serverless autoscaling the Application with Knative</a>
<ul class="sectlevel2">
<li><a href="#_add_the_target_namespace_to_servicemeshmemberroll">Add the target namespace to ServiceMeshMemberRoll</a></li>
<li><a href="#_update_the_application_for_serverless">Update the Application for Serverless</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Recently updated to include RedHat OpenShift 4.x
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://cloud.ibm.com/kubernetes/catalog/openshiftcluster" target="_blank" rel="noopener">RedHat Openshift Cluster</a></p>
</li>
<li>
<p>Kabanero Enterprise via IBM Cloud Pak for Applications</p>
<div class="ulist">
<ul>
<li>
<p>Install Cloud Pak for Application 4.x on RedHat OpenShift 4.x using <a href="https://www.ibm.com/support/knowledgecenter/en/SSCSJL_4.1.x/install-icpa-cli.html" target="_blank" rel="noopener">CLI Installer for OCP4</a></p>
</li>
<li>
<p>Install Cloud Pak for Application 3.x on RedHat OpenShift 3.x using <a href="https://www.ibm.com/support/knowledgecenter/en/SSCSJL/install-icpa-cli.html" target="_blank" rel="noopener">CLI Installer for OCP3</a></p>
</li>
<li>
<p>Install Cloud Pak for Application from IBM Cloud Catalog <a href="https://cloud.ibm.com/catalog/content/ibm-cp-applications" target="_blank" rel="noopener">IBM Cloud Catalog</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Docker for Desktop - <a href="https://docs.docker.com/docker-for-mac/install/" target="_blank" rel="noopener">Mac</a>, <a href="https://docs.docker.com/docker-for-windows/install/" target="_blank" rel="noopener">Windows</a></p>
</li>
<li>
<p>The following command line (CLI) tools and configured:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.okd.io/download.html" target="_blank" rel="noopener">oc</a></p>
</li>
<li>
<p><a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git" target="_blank" rel="noopener">git</a></p>
</li>
<li>
<p><a href="https://appsody.dev/docs/getting-started/installation" target="_blank" rel="noopener">appsody</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_add_stacks_to_appsody"><a class="anchor" href="#_add_stacks_to_appsody"></a>Add Stacks to appsody</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>From the Cloud Pak for Applications landing page get the <code>Appsody</code> URL, for example:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code><a href="https://github.com/kabanero-io/kabanero-stack-hub/releases/download/0.6.3/kabanero-stack-hub-index.yaml" class="bare">https://github.com/kabanero-io/kabanero-stack-hub/releases/download/0.6.3/kabanero-stack-hub-index.yaml</a></code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the appsody CLI to add add the URL for your stack configuration file:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody repo add kabanero https://github.com/kabanero-io/kabanero-stack-hub/releases/download/0.6.3/kabanero-stack-hub-index.yaml</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If possible, remove other repos that are existing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To get the list of available repos, run this command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody repo list</code></pre>
</div>
</div>
<div class="paragraph">
<p>This returns you something like below</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ appsody repo list

NAME            URL
*incubator      https://github.com/appsody/stacks/releases/latest/download/incubator-index.yaml
experimental    https://github.com/appsody/stacks/releases/latest/download/experimental-index.yaml
kabanero        https://github.com/kabanero-io/kabanero-stack-hub/releases/download/0.6.3/kabanero-stack-hub-index.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>To remove the unused repos, run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody repo remove &lt;NAME&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For instance, if you want to remove <code>appsodyhub</code>, then it will be <code>appsody repo remove appsodyhub</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List the appsody stacks available in the Collection:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody list kabanero</code></pre>
</div>
</div>
<div class="paragraph">
<p>It gives you the list of available stacks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ appsody list kabanero

REPO    	ID               	VERSION  	TEMPLATES        	DESCRIPTION
kabanero	java-microprofile	0.2.26   	*default         	Eclipse MicroProfile on Open Liberty &amp; OpenJ9 using Maven
kabanero	java-openliberty 	0.2.3    	*default         	Open Liberty &amp; OpenJ9 using Maven
kabanero	java-spring-boot2	0.3.24   	*default, kotlin 	Spring Boot using OpenJ9 and Maven
kabanero	nodejs           	0.3.3    	*simple          	Runtime for Node.js applications
kabanero	nodejs-express   	0.2.10   	scaffold, *simple	Express web framework for Node.js</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the <code>kabanero</code> repo as default.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody repo set-default kabanero</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to customize the appsody stacks and extend them, refer to <a href="https://www.ibm.com/support/knowledgecenter/SSCSJL_4.1.x/guides/guide-working-with-stacks/README.html">Customizing application stacks</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appsody_application"><a class="anchor" href="#_appsody_application"></a>Appsody application</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_create_a_new_application"><a class="anchor" href="#_create_a_new_application"></a>Create a new Application</h3>
<div class="ulist">
<ul>
<li>
<p>Create a new directory for the project and change directory into it.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir appsody_sample_nodejs-express

cd appsody_sample_nodejs-express/</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Initialize the project using <code>appsody init</code> by selecting the desired stack ID template <code>simple</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody init kabanero/nodejs-express</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The directory contains a minimal set of artifacts</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>.
├── app.js
├── package-lock.json
├── package.json
└── test
    └── test.js</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">app.js</dt>
<dd>
<p>A sample javascript app</p>
</dd>
<dt class="hdlist1">package.json</dt>
<dd>
<p>The application&#8217;s npm dependency tree</p>
</dd>
<dt class="hdlist1">test.js</dt>
<dd>
<p>The application&#8217;s package manifest</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_build_the_application"><a class="anchor" href="#_build_the_application"></a>Build the application</h3>
<div class="paragraph">
<p>This command will locally build a docker image of your appsody project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody build</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once it builds successfully, you will see something like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[Docker] Successfully built 8dbee1649108
[Docker] Successfully tagged dev.local/appsody-sample-nodejs-express:latest
Built docker image dev.local/appsody-sample-nodejs-express
Running command: docker create --name appsody-sample-nodejs-express-extract docker.io/kabanero/nodejs-express:0.2</code></pre>
</div>
</div>
<div class="paragraph">
<p>It helps you to check that stack is stable and init is done correctly. You do not need to run build directly ever again.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test_the_application"><a class="anchor" href="#_test_the_application"></a>Test the Application</h3>
<div class="ulist">
<ul>
<li>
<p>Test the application using appsody</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody test</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step is building a container and running the test command inside of it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Running test environment
Running command: docker pull kabanero/nodejs-express:0.2
...
[Container]
[Container]
[Container] App started on PORT 3000
[Container]   Node.js Express Simple template
[Container]     / endpoint
[Container]       ✓ status
[Container]
[Container]
[Container]   1 passing (38ms)
[Container]
[Container] The file watcher is not running because no APPSODY_RUN/TEST/DEBUG_ON_CHANGE action was specified or it has been disabled using the --no-watcher flag.
Closing down development environment.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_the_application"><a class="anchor" href="#_run_the_application"></a>Run the Application</h3>
<div class="ulist">
<ul>
<li>
<p>Run the application using appsody</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody run</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step is building a container and running it, the output has the endpoint for the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Running development environment...
Pulling docker image docker.io/kabanero/nodejs-express:0.2
Running command: docker pull docker.io/kabanero/nodejs-express:0.2
0.2: Pulling from kabanero/nodejs-express
Digest: sha256:e146ec0b008cd122f3c87b50e2d69102141f71dfd44239d1dbaeac97d06737a0
Status: Image is up to date for kabanero/nodejs-express:0.2
docker.io/kabanero/nodejs-express:0.2
Running command: docker run --rm -p 8080:8080 -p 9229:9229 -p 3000:3000 --name appsody-sample-nodejs-express -v /Users/csantana23/dev/kabanero/demos/cp4apps41/appsody_sample_nodejs-express/:/project/user-app -v appsody-appsody-sample-nodejs-express-20200411182922.16881400:/project/user-app/node_modules -v appsody-controller-0.3.4:/.appsody -t --entrypoint /.appsody/appsody-controller docker.io/kabanero/nodejs-express:0.2 "--mode=run"
[Container] Running APPSODY_PREP command: npm install --prefix user-app
audited 295 packages in 1.457s
[Container]
[Container] &gt; nodejs-express@0.2.10 start /project
[Container] &gt; node server.js
[Container]
[Container] [Sat Apr 11 22:36:35 2020] com.ibm.diagnostics.healthcenter.loader INFO: Node Application Metrics 5.1.1.202003102146 (Agent Core 4.0.5)
[Container] [Sat Apr 11 22:36:36 2020] com.ibm.diagnostics.healthcenter.mqtt INFO: Connecting to broker localhost:1883
[Container] App started on PORT 3000</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the application using the web browser at <a href="http://localhost:3000" class="bare">http://localhost:3000</a> .</p>
</li>
<li>
<p>By default, the template provides the below endpoints.</p>
<div class="ulist">
<ul>
<li>
<p>Readiness endpoint: <a href="http://localhost:3000/ready" class="bare">http://localhost:3000/ready</a></p>
</li>
<li>
<p>Liveness endpoint: <a href="http://localhost:3000/live" class="bare">http://localhost:3000/live</a></p>
</li>
<li>
<p>Health check endpoint: <a href="http://localhost:3000/health" class="bare">http://localhost:3000/health</a></p>
</li>
<li>
<p>Metrics endpoint: <a href="http://localhost:3000/metrics" class="bare">http://localhost:3000/metrics</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details, refer <a href="https://github.com/appsody/stacks/blob/master/incubator/nodejs-express/README.md">Node.js Express Stack</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stop_the_application"><a class="anchor" href="#_stop_the_application"></a>Stop the Application</h3>
<div class="ulist">
<ul>
<li>
<p>To stop the application container, run this command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody stop</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Alternatively, you can also press <code>Ctrl+C</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_debug_the_application"><a class="anchor" href="#_debug_the_application"></a>Debug the Application</h3>
<div class="ulist">
<ul>
<li>
<p>Open your editor. We are using <code>VS Code</code>. Add the project to your workspace, or use the command <code>code .</code></p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_vscode_project.png" alt="js lab1 vscode project">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Open a new terminal window inside VS Code. Use <code>View&#8594;Terminal</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_vscode_terminal.png" alt="js lab1 vscode terminal">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To debug the application including reloading the application on code changes run the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody debug</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output indicates the debug environment is being used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Running debug environment
Pulling docker image docker.io/kabanero/nodejs-express:0.2
Running command: docker pull docker.io/kabanero/nodejs-express:0.2
0.2: Pulling from kabanero/nodejs-express
Digest: sha256:e146ec0b008cd122f3c87b50e2d69102141f71dfd44239d1dbaeac97d06737a0
Status: Image is up to date for kabanero/nodejs-express:0.2
docker.io/kabanero/nodejs-express:0.2
Running command: docker run --rm -p 3000:3000 -p 8080:8080 -p 9229:9229 --name appsody-sample-nodejs-express -v /Users/csantana23/Documents/dev/kabanero/demos/cp4apps41/appsody_sample_nodejs-express/:/project/user-app -v appsody-appsody-sample-nodejs-express-20200411182922.16881400:/project/user-app/node_modules -v appsody-controller-0.3.4:/.appsody -t --entrypoint /.appsody/appsody-controller docker.io/kabanero/nodejs-express:0.2 "--mode=debug"
[Container] Running APPSODY_PREP command: npm install --prefix user-app
audited 295 packages in 1.486s
[Container]
[Container] &gt; nodejs-express@0.2.10 debug /project
[Container] &gt; node --inspect=0.0.0.0 server.js
[Container]
[Container] Debugger listening on ws://0.0.0.0:9229/570389b5-9dcd-43b1-920d-9b7e5cb75fd4
[Container] For help, see: https://nodejs.org/en/docs/inspector
[Container] [Sat Apr 11 22:40:25 2020] com.ibm.diagnostics.healthcenter.loader INFO: Node Application Metrics 5.1.1.202003102146 (Agent Core 4.0.5)
[Container] [Sat Apr 11 22:40:25 2020] com.ibm.diagnostics.healthcenter.mqtt INFO: Connecting to broker localhost:1883
[Container] App started on PORT 3000</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Now you can open the application at <a href="http://localhost:3000/" class="bare">http://localhost:3000/</a></p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_endpoint.png" alt="js lab1 endpoint">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Let us make a code change.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_code_change.png" alt="js lab1 code change">
</div>
</div>
<div class="paragraph">
<p>Here, the debugger will reload the application for you.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Refresh the browser to see the changes.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_endpoint_test.png" alt="js lab1 endpoint test">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can attach to the Node.js debugger using <code>VSCode</code></p>
</li>
<li>
<p>To access the debug view use <code>View&#8594;Debug</code> or click Debug icon on left menu</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_vscode_debug.png" alt="js lab1 vscode debug">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a breakpoint to the application, click to the left of the line number</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_vscode_breakpoint.png" alt="js lab1 vscode breakpoint">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on the debug task <code>Appsody: Attach node</code></p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_vscode_attach.png" alt="js lab1 vscode attach">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Refresh the browser and watch how the debugger stops at the breakpoint</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_vscode_attach_break.png" alt="js lab1 vscode attach break">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appsody_tasks_on_vs_code"><a class="anchor" href="#_appsody_tasks_on_vs_code"></a>Appsody tasks on VS Code</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>To access the build tasks on VS code, go to</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Terminal &gt; Run Build Task...</pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_build_task_menu.png" alt="js lab1 build task menu">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You will see a list of available tasks.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_build_task_list.png" alt="js lab1 build task list">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <code>Appsody: run</code> and this will run the application.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_build_task_run.png" alt="js lab1 build task run">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once, it is successfully started, you can access the application at <a href="http://localhost:3000/" class="bare">http://localhost:3000/</a></p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_endpoint.png" alt="js lab1 endpoint">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Run the <code>Appsody: stop</code> task</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_build_task_stop.png" alt="js lab1 build task stop">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_codewind_on_vs_code"><a class="anchor" href="#_codewind_on_vs_code"></a>Codewind on VS Code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Codewind simplifies and enhances development in containers by extending industry-standard IDEs with features to write, debug, and deploy cloud-native applications. It helps you to get started quickly with templates or samples, or you can also pull in your applications and let Codewind get them cloud-ready.</p>
</div>
<div class="paragraph">
<p>Codewind supports VS Code, Eclipse Che, and Eclipse. In this lab, we are using VS Code as our IDE.</p>
</div>
<div class="sect2">
<h3 id="_getting_the_codewind_extension"><a class="anchor" href="#_getting_the_codewind_extension"></a>Getting the Codewind extension</h3>
<div class="ulist">
<ul>
<li>
<p>To get codewind extension you need <a href="https://code.visualstudio.com/download">VS Code version 1.28 or later</a>.</p>
</li>
<li>
<p>Go to the extensions view and search for codewind from the VS code market place.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/js_lab1_vscode_codewind_extension.png" alt="Codewind extensions" width="500">
</div>
</div>
<div class="paragraph">
<p>You will find <code>Codewind</code> then click <code>install</code> to get it. Also, if you want to use Codewind for Node.js performance analysis, you need to install <code>Codewind Node.js Profiler</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Once you get them installed, let us now open the <code>Codewind</code> in the IDE.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>View &gt; Open View...</pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_lab1_vscode_view.png" alt="sb lab1 vscode view">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>It gives you you a list of options. Select <code>Codewind</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_lab1_vscode_code_explorer.png" alt="sb lab1 vscode code explorer">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>This opens the <code>Codewind</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_lab1_vscode_codewind_explorer.png" alt="sb lab1 vscode codewind explorer">
</div>
</div>
<div class="paragraph">
<p>If you want to configure codewind with appsody, checkout <a href="codewind-setup-appsody.html" class="page">Configure CodeWind with Appsody CLI</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adding_the_application"><a class="anchor" href="#_adding_the_application"></a>Adding the application</h3>
<div class="ulist">
<ul>
<li>
<p>You can create a new project or add an existing project to Codewind. Since, we already created one using appsody earlier, let us add the existing project.</p>
</li>
<li>
<p>Right click on <code>Projects</code> under Codewind. Select <code>Add Existing Project</code> in the menu.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_lab1_codewind_add_existing_project.png" alt="sb lab1 codewind add existing project">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>From the codewind workspace, select the project you created earlier.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_add_existing_prj_from_workspace.png" alt="js lab1 add existing prj from workspace">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The codewind extension asks you for confirmation as follows. Click <code>Yes</code>.</p>
</li>
<li>
<p>The project will be added.</p>
</li>
<li>
<p>Once it is successfully built, it starts running.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_appsody_project_running.png" alt="js lab1 appsody project running">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_project_options"><a class="anchor" href="#_project_options"></a>Project Options</h3>
<div class="ulist">
<ul>
<li>
<p>Go to the application and <code>right click</code> on it to access the various options available.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_codewind_project_options.png" alt="js lab1 codewind project options">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click <code>Open App</code> to access the application.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_codewind_open_app.png" alt="js lab1 codewind open app">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
- Codewind exposes your applications on different external ports. This will allow you to run multiple projects of same type.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>To get the overview of your project, click on <code>Open Project Overview</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_codewind_project_overview.png" alt="js lab1 codewind project overview">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can access the container shell directly from the IDE by using <code>Open Container Shell</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_codewind_container_shell.png" alt="js lab1 codewind container shell">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To access the logs of the application, click on <code>Show all logs</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_codewind_project_logs.png" alt="js lab1 codewind project logs">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can also hide the logs if you want to by using <code>Hide all logs</code> option.</p>
</li>
<li>
<p>If you have multiple applications and want to manage the logs for them, you can use <code>Manage logs</code>.</p>
</li>
<li>
<p>You can also run the application by using <code>Restart in Run Mode</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_codewind_project_restart_in_run_mode.png" alt="js lab1 codewind project restart in run mode">
</div>
</div>
<div class="paragraph">
<p>Once it is restarted, you can access the application by clicking on the button as shown below.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_restart_in_run_mode_app.png" alt="js lab1 restart in run mode app">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Similarly, you can also do debugging by using <code>Restart in Debug Mode</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_application_performance_monitor_profiling_with_codewind"><a class="anchor" href="#_application_performance_monitor_profiling_with_codewind"></a>Application Performance, Monitor, Profiling with Codewind</h3>
<div class="ulist">
<ul>
<li>
<p>You can launch the app monitor by selecting <code>Open Appplication Monitor</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Version <code>0.9.0</code> of Codewind in VSCode has a bug that doesn&#8217;t show the metrics or the performance dashboards <a href="https://github.com/eclipse/codewind/issues/2664" class="bare">https://github.com/eclipse/codewind/issues/2664</a>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/js_lab1_codewind_app_monitor.png" alt="js lab1 codewind app monitor">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The monitor dashboard will open in the browser</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/js_lab1_app_monitor_dashboard.png" alt="js lab1 app monitor dashboard">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can launch the app performance dashboard by selecting <code>Open Performance Dashboard</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/js_lab1_app_performance.png" alt="js lab1 app performance">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The performance dashboard will open in the browser</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/js_lab1_app_performance_dashboard.png" alt="js lab1 app performance dashboard">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can click Run Test and have Monitor and Performance dashboars side by side during the test.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/js_lab1_app_side_by_side_perf_test.png" alt="js lab1 app side by side perf test">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Profiling the node.js code is currently not working an <a href="https://github.com/eclipse/codewind-node-profiler/issues/5">issue</a> is opened on the github repo for the codewind node.js profiler extension
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploy_the_appsody_application_on_openshift_for_team_development"><a class="anchor" href="#_deploy_the_appsody_application_on_openshift_for_team_development"></a>Deploy the appsody application on Openshift for team development</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_set_up_team_project_namespace"><a class="anchor" href="#_set_up_team_project_namespace"></a>Set up team project namespace</h3>
<div class="ulist">
<ul>
<li>
<p>Create a new project for your team if it does not exist. Or if you have an existing project, skip this step.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc new-project &lt;yournamespace&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you create it, you will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc new-project kabanero-samples
Now using project "kabanero-samples" on server "https://c100-e.us-east.containers.cloud.ibm.com:31718".

You can add applications to this project with the 'new-app' command. For example, try:

    oc new-app centos/ruby-25-centos7~https://github.com/sclorg/ruby-ex.git

to build a new example application in Ruby.</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Switch to the target project using the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project &lt;yournamespace&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It gives you the below message if you are already in that space.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc project kabanero-samples
Already on project "kabanero-samples" on server "https://c100-e.us-east.containers.cloud.ibm.com:31718".</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Check that the current context is your team&#8217;s project space.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project -q</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc project -q
kabanero-samples</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_add_new_target_namespace"><a class="anchor" href="#_add_new_target_namespace"></a>Add new Target Namespace</h3>
<div class="ulist">
<ul>
<li>
<p>In order to deploy you app to the new project (kabanero-samples), perform the following:</p>
</li>
<li>
<p>First check that you have kabanero available</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get kabaneros -n kabanero
NAME       AGE   VERSION   READY
kabanero   44h   0.6.1     True</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Next, we will have to edit the yaml file configuring kabanero with the following command.</p>
</li>
<li>
<p>This will bring up your default editor</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc edit kabanero kabanero -n kabanero</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Finally, navigate to the <code>spec</code> label within the file and add the following targetNamespaces label.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">spec:
  targetNamespaces:
    - kabanero-samples</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_application_deployment_manifest"><a class="anchor" href="#_create_application_deployment_manifest"></a>Create application deployment manifest</h3>
<div class="ulist">
<ul>
<li>
<p>Extract the appsody deployment config file</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody build</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will generate the file <code>app-deploy.yaml</code> with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: appsody.dev/v1beta1
kind: AppsodyApplication
metadata:
  name: appsody-sample-nodejs-express
  labels:
    image.opencontainers.org/title: appsody-sample-nodejs-express
    stack.appsody.dev/id: nodejs-express
    stack.appsody.dev/version: 0.2.10
spec:
  applicationImage: dev.local/appsody-sample-nodejs-express
  createKnativeService: false
  expose: true
  livenessProbe:
    failureThreshold: 12
    httpGet:
      path: /live
      port: 3000
    initialDelaySeconds: 5
    periodSeconds: 2
  monitoring:
    labels:
      k8s-app: appsody-sample-nodejs-express
  readinessProbe:
    failureThreshold: 12
    httpGet:
      path: /ready
      port: 3000
    initialDelaySeconds: 5
    periodSeconds: 2
    timeoutSeconds: 1
  service:
    annotations:
      prometheus.io/scrape: "true"
    port: 3000
    type: NodePort
  stack: nodejs-express
  version: 1.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the application is deployed in the <code>kabanero</code> namespace. If you want to deploy the application in a different namespace, you need to specify it in this yaml file. In this lab, let&#8217;s use a namespace called <code>kabanero-samples</code> and we can specify it under the metadata as below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: appsody.dev/v1beta1
kind: AppsodyApplication
metadata:
  name: appsody-sample-nodejs-express
  namespace: kabanero-samples</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_git_repo"><a class="anchor" href="#_creating_a_git_repo"></a>Creating a git repo</h3>
<div class="ulist">
<ul>
<li>
<p>Setup your git locally with the content of the application.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git init
git add .
git commit -m "initial commit"</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a github repository and push the code to the remote repository.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git remote add origin $GITHUB_REPOSITORY_URL
git push -u origin master</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_an_access_token"><a class="anchor" href="#_create_an_access_token"></a>Create an access token</h3>
<div class="ulist">
<ul>
<li>
<p>Go to Github <code>Settings</code>.</p>
</li>
<li>
<p>Select <code>Developer settings</code>.</p>
</li>
<li>
<p>Click on <code>Personal access tokens</code>.</p>
</li>
<li>
<p>Select <code>Generate new token</code>.</p>
</li>
<li>
<p>Create a Github access token with permission <code>admin:repo_hook</code></p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_github_token.png" alt="js lab1 github token">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Then finally click <code>Generate token</code> to create one.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details on how to generate Github personal access token refer <a href="https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line">Creating a personal access token</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configure_the_devops_pipeline"><a class="anchor" href="#_configure_the_devops_pipeline"></a>Configure the DevOps Pipeline</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_accessing_tekton_dashboard"><a class="anchor" href="#_accessing_tekton_dashboard"></a>Accessing Tekton dashboard</h3>
<div class="ulist">
<ul>
<li>
<p>Navigate to the menu in the upper left and select instances.</p>
</li>
<li>
<p>Then click the link under the <code>Pipelines</code> label to navigate to <code>Pipelines Dashboard</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/tekton_link_42.png" alt="tekton link 42">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_tekton_dashboard.png" alt="sb lab1 tekton dashboard">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_tekton_webhook_for_git_repo"><a class="anchor" href="#_create_tekton_webhook_for_git_repo"></a>Create Tekton webhook for git repo</h3>
<div class="ulist">
<ul>
<li>
<p>Click on Webhooks in the menu.</p>
</li>
<li>
<p>Click on <code>Add Webhook</code>.</p>
</li>
<li>
<p>Enter the information for the Webhook settings.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_lab1_webhook_settings.png" alt="sb lab1 webhook settings">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Name - &lt;Name for webhook&gt;
Repository URL - &lt;Your github repository URL&gt;
Access Token - &lt;For this, you need to create a Github access token with permission `admin:repo_hook` or select one from the list&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For more information on how to configure github credentials, refer to <a href="tekton-credentials-github.html" class="page">Tekton - Configure GitHub Credentials</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new token as follows.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_lab1_webhook_settings_access_token_create.png" alt="sb lab1 webhook settings access token create">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can also use an existing token if it is already created.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_lab1_webhook_settings_access_token_existing.png" alt="sb lab1 webhook settings access token existing">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_set_up_the_pipeline"><a class="anchor" href="#_set_up_the_pipeline"></a>Set up the pipeline</h3>
<div class="ulist">
<ul>
<li>
<p>Enter the information for the Pipeline settings
NOTE: Replace &lt;your_project&gt; with the name of the target namespace in our case <code>kabanero-samples</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Namespace - kabanero
Pipeline - nodejs-express-build-deploy-pipeline
Service account - kabaner-operator
OCP 3.11 - Docker Registry - docker-registry.default.svc:5000/&lt;your_project&gt;
OCP 4.X - Docker Registry - image-registry.openshift-image-registry.svc:5000/&lt;your_project&gt;</pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_pipeline_settings.png" alt="js lab1 pipeline settings">
</div>
</div>
<div class="paragraph">
<p>Here, we are using the default docker registry that comes with the openshift cluster. Sometimes, you may need to configure a third party registry instead of using the default one. In order to do that, check out <a href="tekton-credentials-docker.html" class="page">Tekton - Configure External Docker Registry</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click Create, a new webhook is created.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, a new Gitub webhook is created on the project repository.</p>
</div>
<div class="paragraph">
<p>You can verify it by going into your <code>github repository &gt; Settings &gt; Webhooks</code> and you should be able to see the webhook created.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Replace &lt;your_project&gt; with the name of the target namespace in our case <code>kabanero-samples</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here, we are using the default pipeline. If you want to customize the pipeline, refer to <a href="https://www.ibm.com/support/knowledgecenter/SSCSJL_4.1.x/guides/guide-curating-pipelines/curating.html">Creating and updating tasks and pipelines</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_the_application"><a class="anchor" href="#_deploy_the_application"></a>Deploy the Application</h3>
<div class="paragraph">
<p>The way to deploy the application is to make a change in the application in the git repository to trigger the tekton webhook and start the DevOps pipeline to build and deploy the application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make a change to the application such as changing the <code>app.js</code> or any other things.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s change from <code>Hello from Appsody Demo!</code> to <code>Hello from Cloud Paks !!!</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Push your changes to the remote git repository.</p>
</li>
<li>
<p>This will trigger the Tekton Pipeline. To see the status of the Pipeline click on <code>PipelineRuns</code> on the menu of the dashboard.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/js_lab1_pipeline_runs.png" alt="js lab1 pipeline runs">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>When the application is built and deployed the application will be available via the expose <code>Route</code>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_ocp_3_11_instructions"><a class="anchor" href="#_ocp_3_11_instructions"></a>OCP 3.11 Instructions</h4>
<div class="ulist">
<ul>
<li>
<p>Go to the OpenShift Console, switch to the project, and select <code>Applications &gt; Routes</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will see a route for your application, click on the url to open your application.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_application_route.png" alt="sb lab1 application route">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ocp_4_x_instructions"><a class="anchor" href="#_ocp_4_x_instructions"></a>OCP 4.X instructions</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Open the menu in the upper left of the OpenShift Console and navigate to Topology.</p>
</li>
<li>
<p>Select your Application in the center, and view the route(s) on the side.</p>
</li>
<li>
<p>Note: Please ensure you are in the developer role (should be default if following this guide)</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/dc_lab1_route_location_42.png" alt="dc lab1 route location 42">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Or you can also get the route from the oc CLI.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get route -n &lt;your_project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For instance,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get routes -n kabanero-samples
NAME                            HOST/PORT                                                                                                                               PATH      SERVICES                        PORT      TERMINATION   WILDCARD
appsody-sample-nodejs-express   appsody-sample-nodejs-express-kabanero-samples.ocp.example.com            appsody-sample-nodejs-express   3000                    None</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now acccess the application at &lt;HOST/PORT&gt;, here it is <code><a href="https://appsody-sample-nodejs-express-kabanero-samples.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud" class="bare">https://appsody-sample-nodejs-express-kabanero-samples.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud</a></code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serverless_autoscaling_the_application_with_knative"><a class="anchor" href="#_serverless_autoscaling_the_application_with_knative"></a>Serverless autoscaling the Application with Knative</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_add_the_target_namespace_to_servicemeshmemberroll"><a class="anchor" href="#_add_the_target_namespace_to_servicemeshmemberroll"></a>Add the target namespace to ServiceMeshMemberRoll</h3>
<div class="ulist">
<ul>
<li>
<p>Edit the resource <code>smmr</code> :</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>oc edit smmr -n knative-serving-ingress</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Append the target namespace into the SMMR resource <code>spec</code> for example <code>kabanero-samples</code> leave any other namespaces already present:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>spec:
  members:
  - knative-serving
  - kabanero-samples</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify the namespace <code>kabanero-samples</code> was added by following this command:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get smmr default -n knative-serving-ingress -o jsonpath={.spec.members}

[knative-serving kabanero-samples]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_update_the_application_for_serverless"><a class="anchor" href="#_update_the_application_for_serverless"></a>Update the Application for Serverless</h3>
<div class="ulist">
<ul>
<li>
<p>Edit the file <code>app-deploy.yaml</code>.</p>
</li>
<li>
<p>Add the line <code>createKnativeService: true</code> to the spec object.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">apiVersion: appsody.dev/v1beta1
kind: AppsodyApplication
metadata:
  name: appsody-sample-nodejs-express
  namespace: kabanero-samples
spec:
  createKnativeService: true</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Git push the change, and see tekton pipeline runs again.</p>
</li>
<li>
<p>Show the Knative resource</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get service.serving.knative.dev/appsody-sample-nodejs-express

NAME                            URL                                                                                                                                            LATESTCREATED                         LATESTREADY                           READY     REASON
appsody-sample-nodejs-express   http://appsody-sample-nodejs-express.kabanero-samples.ocp.example.com  appsody-sample-nodejs-express-mtl4q   appsody-sample-nodejs-express-mtl4q   True</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Show the Knative route</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get route.serving.knative.dev/appsody-sample-nodejs-express

NAME                            URL                                                                                                                                            READY     REASON
appsody-sample-nodejs-express   http://appsody-sample-nodejs-express.kabanero-samples.ocp.example.com  True</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Show the Knative configuration</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get configuration.serving.knative.dev/appsody-sample-nodejs-express

NAME                            LATESTCREATED                         LATESTREADY                           READY     REASON
appsody-sample-nodejs-express   appsody-sample-nodejs-express-mtl4q   appsody-sample-nodejs-express-mtl4q   True</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Show the Knative latest ready revision</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get revision.serving.knative.dev/appsody-sample-nodejs-express-mtl4q

NAME                                  SERVICE NAME                          GENERATION   READY     REASON
appsody-sample-nodejs-express-mtl4q   appsody-sample-nodejs-express-mtl4q   2            True</pre>
</div>
</div>
<div class="paragraph">
<p>Visit the Knative public url <code><a href="http://appsody-sample-nodejs-express.kabanero-samples.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud" class="bare">http://appsody-sample-nodejs-express.kabanero-samples.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud</a></code> and list the pods</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods

NAME                                                              READY     STATUS    RESTARTS   AGE
appsody-sample-nodejs-express-mtl4q-deployment-7bf6dbddf6-rr89p   2/2       Running   0          27s</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Wait 1 minute and you will then see the pods are not longer running</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get pods

No resources found.</pre>
</div>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
