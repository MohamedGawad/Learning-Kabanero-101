<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>End to End Java Spring Boot CP4Apps workflow :: Learning CP4Apps Accelerators for Teams 101</title>
    <link rel="canonical" href="https://github.com/ibm-cloud-architecture/learning-cp4apps-101/web/1.0.0/e2e-java-spring-boot2.html">
    <meta name="generator" content="Antora 2.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-149377589-1"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','UA-149377589-1')</script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <p>CP4Apps Accelerators for Teams 101</p>
      </div>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="web" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="kabanero-overview.html">Learning CP4Apps Accelerators for Teams</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="kabanero-overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installing Cloud Pack for Applications</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://cloud.ibm.com/catalog/content/ibm-cp-applications" target="_blank" rel="noopener">Using IBM Cloud Console ↗</a></span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://www.ibm.com/support/knowledgecenter/en/SSCSJL_4.1.x/install-icpa-cli.html" target="_blank" rel="noopener">OCP4 CLI Installer ↗</a></span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://www.ibm.com/support/knowledgecenter/en/SSCSJL/install-icpa-cli.html" target="_blank" rel="noopener">OCP3 CLI Installer ↗</a></span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Workflows</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="e2e-java-spring-boot2.html">E2E Java Spring Boot 2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="e2e-java-openliberty.html">E2E Java OpenLiberty</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="e2e-nodejs-express.html">E2E Node.js Express</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tasks</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="appsody-deploy.html">Appsody Deploy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="codewind-setup-appsody.html">Configure CodeWind</a>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://www.ibm.com/support/knowledgecenter/SSCSJL_4.1.x/guides/guide-working-with-stacks/README.html" target="_blank" rel="noopener">Customizing Application Stacks ↗</a></span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://www.ibm.com/support/knowledgecenter/SSCSJL_4.1.x/guides/guide-curating-pipelines/curating.html" target="_blank" rel="noopener">Creating and updating tasks and pipelines ↗</a></span>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tekton-credentials-github.html">Configure Github Credentials</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tekton-credentials-docker.html">Configure Docker Credentials</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">External Resources</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://developer.ibm.com/technologies/containers/tutorials/create-appsody-stack" target="_blank" rel="noopener">Create Appsody Stack ↗</a></span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://github.com/gcharters/kabanero-dev-getting-started" target="_blank" rel="noopener">Java MicroProfile Tutorial ↗</a></span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://developer.ibm.com/components/cloud-pak-for-applications" target="_blank" rel="noopener">IBM Cloud Pak for Applications @ IBM Developer ↗</a></span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="references.html">References</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Learning CP4Apps Accelerators for Teams</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Learning CP4Apps Accelerators for Teams</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="kabanero-overview.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="kabanero-overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="kabanero-overview.html">Learning CP4Apps Accelerators for Teams</a></li>
    <li>Workflows</li>
    <li><a href="e2e-java-spring-boot2.html">E2E Java Spring Boot 2</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/ibm-cloud-architecture/learning-cp4apps-101/edit/master/modules/ROOT/pages/e2e-java-spring-boot2.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">End to End Java Spring Boot CP4Apps workflow</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_prerequisites">Prerequisites</a></li>
<li><a href="#_add_stacks_to_appsody">Add Stacks to appsody</a></li>
<li><a href="#_appsody_application">Appsody application</a>
<ul class="sectlevel2">
<li><a href="#_create_a_new_application">Create a new Application</a></li>
<li><a href="#_build_the_application">Build the application</a></li>
<li><a href="#_test_the_application">Test the Application</a></li>
<li><a href="#_run_the_application">Run the Application</a></li>
<li><a href="#_stop_the_application">Stop the Application</a></li>
<li><a href="#_update_the_application">Update the Application</a></li>
<li><a href="#_debug_the_application">Debug the Application</a></li>
</ul>
</li>
<li><a href="#_appsody_tasks_on_vs_code">Appsody tasks on VS Code</a></li>
<li><a href="#_codewind_on_vs_code">Codewind on VS Code</a>
<ul class="sectlevel2">
<li><a href="#_getting_the_codewind_extension">Getting the Codewind extension</a></li>
<li><a href="#_adding_the_application">Adding the application</a></li>
<li><a href="#_project_options">Project Options</a></li>
<li><a href="#_application_performance_monitor_profiling_with_codewind">Application Performance, Monitor, Profiling with Codewind</a></li>
</ul>
</li>
<li><a href="#_deploy_the_appsody_application_on_openshift_for_team_development">Deploy the appsody application on Openshift for team development</a>
<ul class="sectlevel2">
<li><a href="#_set_up_team_project_namespace">Set up team project namespace</a></li>
<li><a href="#_add_new_target_namespace">Add new Target Namespace</a></li>
<li><a href="#_create_application_deployment_manifest">Create application deployment manifest</a></li>
<li><a href="#_creating_a_git_repo">Creating a git repo</a></li>
<li><a href="#_create_an_access_token">Create an access token</a></li>
</ul>
</li>
<li><a href="#_configure_the_devops_pipeline">Configure the DevOps Pipeline</a>
<ul class="sectlevel2">
<li><a href="#_accessing_tekton_dashboard">Accessing Tekton dashboard</a></li>
<li><a href="#_create_tekton_webhook_for_git_repo">Create Tekton webhook for git repo</a></li>
<li><a href="#_set_up_the_pipeline">Set up the pipeline</a></li>
<li><a href="#_deploy_the_application">Deploy the Application</a></li>
</ul>
</li>
<li><a href="#_serverless_autoscaling_the_application_with_knative">Serverless autoscaling the Application with Knative</a>
<ul class="sectlevel2">
<li><a href="#_add_the_target_namespace_to_servicemeshmemberroll">Add the target namespace to ServiceMeshMemberRoll</a></li>
<li><a href="#_update_the_application_for_serverless">Update the Application for Serverless</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Recently updated to include RedHat OpenShift 4.x
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://cloud.ibm.com/kubernetes/catalog/openshiftcluster" target="_blank" rel="noopener">RedHat Openshift Cluster</a></p>
</li>
<li>
<p>Kabanero Enterprise via IBM Cloud Pak for Applications</p>
<div class="ulist">
<ul>
<li>
<p>Install Cloud Pak for Application 4.x on RedHat OpenShift 4.x using <a href="https://www.ibm.com/support/knowledgecenter/en/SSCSJL_4.1.x/install-icpa-cli.html" target="_blank" rel="noopener">CLI Installer for OCP4</a></p>
</li>
<li>
<p>Install Cloud Pak for Application 3.x on RedHat OpenShift 3.x using <a href="https://www.ibm.com/support/knowledgecenter/en/SSCSJL/install-icpa-cli.html" target="_blank" rel="noopener">CLI Installer for OCP3</a></p>
</li>
<li>
<p>Install Cloud Pak for Application from IBM Cloud Catalog <a href="https://cloud.ibm.com/catalog/content/ibm-cp-applications" target="_blank" rel="noopener">IBM Cloud Catalog</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Docker for Desktop - <a href="https://docs.docker.com/docker-for-mac/install/" target="_blank" rel="noopener">Mac</a>, <a href="https://docs.docker.com/docker-for-windows/install/" target="_blank" rel="noopener">Windows</a></p>
</li>
<li>
<p>The following command line (CLI) tools and configured:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.okd.io/download.html" target="_blank" rel="noopener">oc</a></p>
</li>
<li>
<p><a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git" target="_blank" rel="noopener">git</a></p>
</li>
<li>
<p><a href="https://appsody.dev/docs/getting-started/installation" target="_blank" rel="noopener">appsody</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_add_stacks_to_appsody"><a class="anchor" href="#_add_stacks_to_appsody"></a>Add Stacks to appsody</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>From the Cloud Pak for Applications landing page get the <code>Appsody</code> URL, for example:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code><a href="https://github.com/kabanero-io/kabanero-stack-hub/releases/download/0.6.3/kabanero-stack-hub-index.yaml" class="bare">https://github.com/kabanero-io/kabanero-stack-hub/releases/download/0.6.3/kabanero-stack-hub-index.yaml</a></code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the appsody CLI to add add the URL for your stack configuration file:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody repo add kabanero https://github.com/kabanero-io/collections/releases/download/0.3.5/kabanero-index.yaml</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If possible, remove other repos that are existing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To get the list of available repos, run this command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody repo list</code></pre>
</div>
</div>
<div class="paragraph">
<p>This returns you something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ appsody repo list

NAME            URL
*incubator      https://github.com/appsody/stacks/releases/latest/download/incubator-index.yaml
experimental    https://github.com/appsody/stacks/releases/latest/download/experimental-index.yaml
kabanero        https://github.com/kabanero-io/kabanero-stack-hub/releases/download/0.6.3/kabanero-stack-hub-index.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>To remove the unused repos, run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody repo remove &lt;NAME&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For instance, if you want to remove <code>appsodyhub</code>, then it will be <code>appsody repo remove appsodyhub</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List the appsody stacks available in the Collection:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody list kabanero</code></pre>
</div>
</div>
<div class="paragraph">
<p>It gives you the list of available stacks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ appsody list kabanero

REPO    	ID               	VERSION  	TEMPLATES        	DESCRIPTION
kabanero	java-microprofile	0.2.26   	*default         	Eclipse MicroProfile on Open Liberty &amp; OpenJ9 using Maven
kabanero	java-openliberty 	0.2.3    	*default         	Open Liberty &amp; OpenJ9 using Maven
kabanero	java-spring-boot2	0.3.24   	*default, kotlin 	Spring Boot using OpenJ9 and Maven
kabanero	nodejs           	0.3.3    	*simple          	Runtime for Node.js applications
kabanero	nodejs-express   	0.2.10   	scaffold, *simple	Express web framework for Node.js</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the <code>kabanero</code> repo as default.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody repo set-default kabanero</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to customize the appsody stacks and extend them, refer to <a href="https://www.ibm.com/support/knowledgecenter/SSCSJL_4.1.x/guides/guide-working-with-stacks/README.html">Customizing application stacks</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appsody_application"><a class="anchor" href="#_appsody_application"></a>Appsody application</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_create_a_new_application"><a class="anchor" href="#_create_a_new_application"></a>Create a new Application</h3>
<div class="ulist">
<ul>
<li>
<p>Create a new directory for the project and change directory into it.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir appsody_sample_springboot

cd appsody_sample_springboot/</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Initialize the project using <code>appsody init</code> by selecting the desired stack ID template <code>simple</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody init kabanero/java-spring-boot2</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The directory contains a minimal set of artifacts</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>.
├── mvnw
├── mvnw.cmd
├── pom.xml
└── src
    ├── main
    │   ├── java
    │   │   └── application
    │   │       ├── LivenessEndpoint.java
    │   │       └── Main.java
    │   └── resources
    │       ├── application.properties
    │       └── public
    │           └── index.html
    └── test
        └── java
            └── application
                └── MainTests.java</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Main.java</dt>
<dd>
<p>Spring Application class</p>
</dd>
<dt class="hdlist1">LivenessEndpoint.java</dt>
<dd>
<p>An example Liveness Endpoint</p>
</dd>
<dt class="hdlist1">MainTests.java</dt>
<dd>
<p>A simple test class</p>
</dd>
<dt class="hdlist1">application.properties</dt>
<dd>
<p>Containing some configuration options for Spring</p>
</dd>
<dt class="hdlist1">index.html</dt>
<dd>
<p>A static file</p>
</dd>
<dt class="hdlist1">pom.xml</dt>
<dd>
<p>The project build file</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_build_the_application"><a class="anchor" href="#_build_the_application"></a>Build the application</h3>
<div class="paragraph">
<p>This command will locally build a docker image of your appsody project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody build</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once it builds successfully, you will see something like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[Docker] Step 71/71 : LABEL version=0.3.23
[Docker]  ---&gt; Running in 4818208fe3ab
[Docker] Removing intermediate container 4818208fe3ab
[Docker]  ---&gt; c5ec2b8a9377
[Docker] Successfully built c5ec2b8a9377
[Docker] Successfully tagged dev.local/appsody-sample-springboot:latest
Built docker image dev.local/appsody-sample-springboot
Running command: docker create --name appsody-sample-springboot-extract docker.io/kabanero/java-spring-boot2:0.3</code></pre>
</div>
</div>
<div class="paragraph">
<p>It helps you to check that stack is stable and init is done correctly. You do not need to run build directly ever again.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test_the_application"><a class="anchor" href="#_test_the_application"></a>Test the Application</h3>
<div class="ulist">
<ul>
<li>
<p>Test the application using appsody</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody test</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step is building a container and running the test command inside of it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[Container] [INFO] ------------------------------------------------------------------------
[Container] [INFO] BUILD SUCCESS
[Container] [INFO] ------------------------------------------------------------------------
[Container] [INFO] Total time:  01:01 min
[Container] [INFO] Finished at: 2020-04-12T03:09:06Z
[Container] [INFO] ------------------------------------------------------------------------</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_the_application"><a class="anchor" href="#_run_the_application"></a>Run the Application</h3>
<div class="ulist">
<ul>
<li>
<p>Run the application using appsody</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody run</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step is building a container and running it, the output has the endpoint for the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Running development environment...
Running command: docker[pull kabanero/java-spring-boot2:0.3]
Running docker command: docker[run --rm -p 5005:5005 -p 8080:8080 -p 35729:35729 --name appsody-sample-springboot-dev -u 501:20 -e APPSODY_USER=501 -e APPSODY_GROUP=20 -v /Users/&lt;user&gt;@ibm.com/kabanero101/appsody_sample_springboot/.:/project/user-app -v /Users/&lt;user&gt;@ibm.com/.m2/repository:/mvn/repository -v /Users/&lt;user&gt;@ibm.com/.appsody/appsody-controller:/appsody/appsody-controller -t --entrypoint /appsody/appsody-controller kabanero/java-spring-boot2:0.3 --mode=run]
......
......
......
[Container] 2019-09-12 17:49:22.173  INFO 185 --- [  restartedMain] o.s.b.a.e.web.EndpointLinksResolver      : Exposing 4 endpoint(s) beneath base path '/actuator'
[Container] 2019-09-12 17:49:22.377  INFO 185 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
[Container] 2019-09-12 17:49:22.386  INFO 185 --- [  restartedMain] application.Main                         : Started Main in 7.984 seconds (JVM running for 9.679)
[Container] 2019-09-12 17:58:42.777  INFO 185 --- [nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
[Container] 2019-09-12 17:58:42.777  INFO 185 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
[Container] 2019-09-12 17:58:42.805  INFO 185 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 27 ms
[Container] 2019-09-12 17:58:43.044  INFO 185 --- [nio-8080-exec-1] i.j.internal.reporters.LoggingReporter   : Span reported: 445d02b19cea491:445d02b19cea491:0:1 - GET</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the application using the web browser at <a href="http://localhost:8080" class="bare">http://localhost:8080</a>.</p>
</li>
<li>
<p>By default, the template provides the below endpoints.</p>
<div class="ulist">
<ul>
<li>
<p>Health endpoint: <a href="http://localhost:8080/actuator/health" class="bare">http://localhost:8080/actuator/health</a></p>
</li>
<li>
<p>Liveness endpoint: <a href="http://localhost:8080/actuator/liveness" class="bare">http://localhost:8080/actuator/liveness</a></p>
</li>
<li>
<p>Metrics endpoint: <a href="http://localhost:8080/actuator/metrics" class="bare">http://localhost:8080/actuator/metrics</a></p>
</li>
<li>
<p>Prometheus endpoint: <a href="http://localhost:8080/actuator/prometheus" class="bare">http://localhost:8080/actuator/prometheus</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details, refer <a href="https://github.com/appsody/stacks/blob/master/incubator/java-spring-boot2/README.md">Spring® Boot 2 Stack</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stop_the_application"><a class="anchor" href="#_stop_the_application"></a>Stop the Application</h3>
<div class="ulist">
<ul>
<li>
<p>To stop the application container, run this command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody stop</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Alternatively, you can also press <code>Ctrl+C</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_update_the_application"><a class="anchor" href="#_update_the_application"></a>Update the Application</h3>
<div class="ulist">
<ul>
<li>
<p>Lets add a new endpoint API to our Application</p>
<div class="paragraph">
<p>Add the following file <code>src/main/java/application/ExampleEndpoint.java</code> and populate with the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package application;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class ExampleEndpoint {

    @RequestMapping("/starter/hello")
    public String example() {
        return "Hello World";
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_code_change.png" alt="sb lab1 code change">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the browser and navigate to the endpoint url <a href="http://localhost:8080/starter/hello" class="bare">http://localhost:8080/starter/hello</a></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_hello_endpoint.png" alt="sb lab1 hello endpoint">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Make a change to the application and refresh the browser for example <code>Hello World Demo</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_hello_refresh.png" alt="sb lab1 hello refresh">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_debug_the_application"><a class="anchor" href="#_debug_the_application"></a>Debug the Application</h3>
<div class="ulist">
<ul>
<li>
<p>Open your editor. We are using <code>VS Code</code>. Add the project to your workspace, or use the command <code>code .</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_open_project_vscode.png" alt="sb lab1 open project vscode">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Open a new terminal window inside VS Code. Use <code>View&#8594;Terminal</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_open_terminal.png" alt="sb lab1 open terminal">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To debug the application including reloading the application on code changes run the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody debug</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output indicates the debug environment is being used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Running debug environment
Running command: docker[pull kabanero/java-spring-boot2:0.3]
Running docker command: docker[run --rm -p 35729:35729 -p 5005:5005 -p 8080:8080 --name appsody-sample-springboot-dev -u 501:20 -e APPSODY_USER=501 -e APPSODY_GROUP=20 -v /Users/&lt;user&gt;@ibm.com/kabanero101/appsody_sample_springboot/.:/project/user-app -v /Users/&lt;user&gt;@ibm.com/.m2/repository:/mvn/repository -v /Users/&lt;user&gt;@ibm.com/.appsody/appsody-controller:/appsody/appsody-controller -t --entrypoint /appsody/appsody-controller kabanero/java-spring-boot2:0.3 --mode=debug]
.......
.......
.......
[Container] [INFO] --- maven-compiler-plugin:3.8.1:testCompile (default-testCompile) @ application ---
[Container] [INFO] Changes detected - recompiling the module!
[Container] [INFO] Compiling 1 source file to /project/user-app/target/test-classes
[Container] [INFO]
[Container] [INFO] &lt;&lt;&lt; spring-boot-maven-plugin:2.1.6.RELEASE:run (default-cli) &lt; test-compile @ application &lt;&lt;&lt;
[Container] [INFO]
[Container] [INFO]
[Container] [INFO] --- spring-boot-maven-plugin:2.1.6.RELEASE:run (default-cli) @ application ---
[Container] [INFO] Attaching agents: []
[Container] Listening for transport dt_socket at address: 5005</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can attach to the debugger using <code>VSCode</code></p>
</li>
<li>
<p>To access the debug view use <code>View&#8594;Debug</code> or click Debug icon on left menu</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_vscode_debug.png" alt="sb lab1 vscode debug">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a breakpoint to the application, click to the left of the line number</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_vscode_breakpoint.png" alt="sb lab1 vscode breakpoint">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on the debug task <code>Appsody: Attach java debugger</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_vscode_attach.png" alt="sb lab1 vscode attach">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the browser on the new endpoint <a href="http://localhost:8080/starter/hello" class="bare">http://localhost:8080/starter/hello</a> and watch how the debugger stops at the breakpoint.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_vscode_attach_break.png" alt="sb lab1 vscode attach break">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appsody_tasks_on_vs_code"><a class="anchor" href="#_appsody_tasks_on_vs_code"></a>Appsody tasks on VS Code</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>To access the build tasks on VS code, go to</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Terminal &gt; Run Build Task...</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_build_task_menu.png" alt="sb lab1 build task menu">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You will see a list of available tasks.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_build_task_list.png" alt="sb lab1 build task list">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <code>Appsody: run</code> and this will run the application.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_build_task_run.png" alt="sb lab1 build task run">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once, it is successfully started, you can access the application at <a href="http://localhost:8080/" class="bare">http://localhost:8080/</a>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_build_task_run_app.png" alt="sb lab1 build task run app">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_codewind_on_vs_code"><a class="anchor" href="#_codewind_on_vs_code"></a>Codewind on VS Code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Codewind simplifies and enhances development in containers by extending industry standard IDEs with features to write, debug, and deploy cloud-native applications. It helps you to get started quickly with templates or samples, or you can also pull in your applications and let Codewind get them cloud ready.</p>
</div>
<div class="paragraph">
<p>Codewind supports VS Code, Eclipse Che, and Eclipse. In this lab, we are using VS Code as our IDE.</p>
</div>
<div class="sect2">
<h3 id="_getting_the_codewind_extension"><a class="anchor" href="#_getting_the_codewind_extension"></a>Getting the Codewind extension</h3>
<div class="ulist">
<ul>
<li>
<p>Go to the extensions view and search for codewind from the VS code market place.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_vscode_codewind_extension.png" alt="sb lab1 vscode codewind extension">
</div>
</div>
<div class="paragraph">
<p>You will find <code>Codewind</code> then click <code>install</code> to get it. Also, if you want to use Codewind for Node.js performance analysis, you need to install <code>Codewind Node.js Profiler</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Once you get them installed, let us now open the <code>Codewind</code> in the IDE.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>View &gt; Open View...</pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_lab1_vscode_view.png" alt="sb lab1 vscode view">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>It gives you you a list of options. Select <code>Codewind</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_lab1_vscode_code_explorer.png" alt="sb lab1 vscode code explorer">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>This opens the <code>Codewind</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_lab1_vscode_codewind_explorer.png" alt="sb lab1 vscode codewind explorer">
</div>
</div>
<div class="paragraph">
<p>If you want to configure codewind with appsody, checkout <a href="codewind-setup-appsody.html" class="page">Configure CodeWind with Appsody CLI</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adding_the_application"><a class="anchor" href="#_adding_the_application"></a>Adding the application</h3>
<div class="ulist">
<ul>
<li>
<p>You can create a new project or add an existing project to Codewind. Since, we already created one using appsody earlier, let us add the existing project.</p>
</li>
<li>
<p>Right click on <code>Projects</code> under Codewind. Select <code>Add Existing Project</code> in the menu.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_lab1_codewind_add_existing_project.png" alt="sb lab1 codewind add existing project">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>From the codewind workspace, select the project you created earlier.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_add_existing_prj_from_workspace.png" alt="sb lab1 add existing prj from workspace">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The codewind extension asks you for confirmation as follows. Click <code>Yes</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_appsody_extension.png" alt="sb lab1 appsody extension">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The project will be added.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_appsody_project.png" alt="sb lab1 appsody project">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once it is successfully build, it starts running.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_appsody_project_running.png" alt="sb lab1 appsody project running">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_project_options"><a class="anchor" href="#_project_options"></a>Project Options</h3>
<div class="ulist">
<ul>
<li>
<p>Go to the application and <code>right click</code> on it to access the various options available.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_code_wind_project_options.png" alt="sb lab1 code wind project options">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click <code>Open App</code> to access the application.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_codewind_open_app.png" alt="sb lab1 codewind open app">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
- Codewind exposes your applications on different external ports. This will allow you to run multiple projects of same type.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>To get the overview of your project, click on <code>Open Project Overview</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_codewind_project_overview.png" alt="sb lab1 codewind project overview">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can access the container shell directly from the IDE by using <code>Open Container Shell</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_codewind_container_shell.png" alt="sb lab1 codewind container shell">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To access the logs of the application, click on <code>Show all logs</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_codewind_project_logs.png" alt="sb lab1 codewind project logs">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can also hide the logs if you want to by using <code>Hide all logs</code> option.</p>
</li>
<li>
<p>If you have multiple applications and want to manage the logs for them, you can use <code>Manage logs</code>.</p>
</li>
<li>
<p>You can also run the application by using <code>Restart in Run Mode</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_codewind_project_restart_in_run_mode.png" alt="sb lab1 codewind project restart in run mode">
</div>
</div>
<div class="paragraph">
<p>Once it is restarted, you can access the application by clicking on the button as shown below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_restart_in_run_mode_app.png" alt="sb lab1 restart in run mode app">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Similarly, you can also do debugging by using <code>Restart in Debug Mode</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_application_performance_monitor_profiling_with_codewind"><a class="anchor" href="#_application_performance_monitor_profiling_with_codewind"></a>Application Performance, Monitor, Profiling with Codewind</h3>
<div class="ulist">
<ul>
<li>
<p>You can launch the app monitor by selecting <code>Open Appplication Monitor</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_code_wind_project_options.png" alt="sb lab1 code wind project options">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click <code>Open Application Monitor</code> to access the application monitor.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong class="maroon">Enabling Javametrics</strong></p>
</div>
<div class="paragraph">
<p>For Springboot project, you need to set up the Javametrics before accessing the application monitor.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
- For editing these files, you can use the option <code>Add Folder to Workspace</code> and open it in your VS code editor.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>To the sample project you created earlier, add the below annotation.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ComponentScan(basePackages = {"com.ibm.javametrics.spring", "&lt;your_package_name&gt;"})</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the sample application, your main class will be as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package application;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.ComponentScan;

@SpringBootApplication
@ComponentScan(basePackages = {"com.ibm.javametrics.spring", "application"})
public class Main {

	public static void main(String[] args) {
		SpringApplication.run(Main.class, args);
	}

}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the below dependencies to your <code>pom.xml</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.ibm.runtimetools&lt;/groupId&gt;
    &lt;artifactId&gt;javametrics-spring&lt;/artifactId&gt;
    &lt;version&gt;1.4.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.ibm.runtimetools&lt;/groupId&gt;
    &lt;artifactId&gt;javametrics-agent&lt;/artifactId&gt;
    &lt;version&gt;1.4.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.glassfish&lt;/groupId&gt;
    &lt;artifactId&gt;javax.json&lt;/artifactId&gt;
    &lt;version&gt;1.0.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Now, restart your application using the option <code>Restart in Run Mode</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_code_wind_perf_restart_app.png" alt="sb lab1 code wind perf restart app">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once the application is restarted, you can access the application monitor and performance dashboard.</p>
</li>
<li>
<p>Click on the <code>Open Application Monitor</code> to access the java metrics dashboard.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_code_wind_perf_app_monitor.png" alt="sb lab1 code wind perf app monitor">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_code_wind_perf_app_monitor_summary.png" alt="sb lab1 code wind perf app monitor summary">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To open the performance dashboard, click on <code>Open Performance Dashboard</code>.</p>
<div class="ulist">
<ul>
<li>
<p>Access the dashboard and then run the test.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_code_wind_perf_dashboard.png" alt="sb lab1 code wind perf dashboard">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a load test as follows. Then refresh your application to create load.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_code_wind_perf_load_test_create.png" alt="sb lab1 code wind perf load test create">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Run the test.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_code_wind_perf_load_test_run.png" alt="sb lab1 code wind perf load test run">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You will see something like below after the first test.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_code_wind_perf_load_test_one.png" alt="sb lab1 code wind perf load test one">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Run couple of tests and you should be able to see the results.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_code_wind_perf_load_test_two.png" alt="sb lab1 code wind perf load test two">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_code_wind_perf_load_test_four.png" alt="sb lab1 code wind perf load test four">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If you scroll down, you can also see the test history details.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_code_wind_perf_load_test_history.png" alt="sb lab1 code wind perf load test history">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
- In codewind, for now the <code>Application Monitor</code> and <code>Performance Dashboard</code> shows up on first run. It does not load the metrics if you reload the dashboard.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploy_the_appsody_application_on_openshift_for_team_development"><a class="anchor" href="#_deploy_the_appsody_application_on_openshift_for_team_development"></a>Deploy the appsody application on Openshift for team development</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_set_up_team_project_namespace"><a class="anchor" href="#_set_up_team_project_namespace"></a>Set up team project namespace</h3>
<div class="ulist">
<ul>
<li>
<p>Create a new project for your team if it does not exist. Or if you have an existing project, skip this step.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc new-project &lt;yournamespace&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you create it, you will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc new-project kabanero-samples
Now using project "kabanero-samples" on server "https://c100-e.us-east.containers.cloud.ibm.com:31718".

You can add applications to this project with the 'new-app' command. For example, try:

    oc new-app centos/ruby-25-centos7~https://github.com/sclorg/ruby-ex.git

to build a new example application in Ruby.</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Switch to the target project using the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project &lt;yournamespace&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It gives you the below message if you are already in that space.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc project kabanero-samples
Already on project "kabanero-samples" on server "https://c100-e.us-east.containers.cloud.ibm.com:31718".</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Check that the current context is your team&#8217;s project space.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project -q</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc project -q
kabanero-samples</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_add_new_target_namespace"><a class="anchor" href="#_add_new_target_namespace"></a>Add new Target Namespace</h3>
<div class="ulist">
<ul>
<li>
<p>In order to deploy you app to the new project (kabanero-samples), perform the following:</p>
</li>
<li>
<p>First check that you have kabanero available</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get kabaneros -n kabanero
NAME       AGE   VERSION   READY
kabanero   44h   0.6.1     True</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Next, we will have to edit the yaml file configuring kabanero with the following command.</p>
</li>
<li>
<p>This will bring up your default editor</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc edit kabanero kabanero -n kabanero</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Finally, navigate to the <code>spec</code> label within the file and add the following targetNamespaces label.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">spec:
  targetNamespaces:
    - kabanero-samples</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_application_deployment_manifest"><a class="anchor" href="#_create_application_deployment_manifest"></a>Create application deployment manifest</h3>
<div class="ulist">
<ul>
<li>
<p>Extract the appsody deployment config file</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody build</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will generate the file <code>app-deploy.yaml</code> with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: appsody.dev/v1beta1
kind: AppsodyApplication
metadata:
  name: appsody-sample-springboot
spec:
  # Add fields here
  version: 1.0.0
  applicationImage: appsody-sample-springboot
  stack: java-spring-boot2
  service:
    type: NodePort
    port: 8080
    annotations:
      prometheus.io/scrape: 'true'
      prometheus.io/path: '/actuator/prometheus'
  readinessProbe:
    failureThreshold: 12
    httpGet:
      path: /actuator/health
      port: 8080
    initialDelaySeconds: 5
    periodSeconds: 2
  livenessProbe:
    failureThreshold: 12
    httpGet:
      path: /actuator/liveness
      port: 8080
    initialDelaySeconds: 5
    periodSeconds: 2
  expose: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the application is deployed in the <code>kabanero</code> namespace. If you want to deploy the application in a different namespace, you can specify it in this yaml file. In this lab, let us use a namespace called <code>kabanero-samples</code> and we can specify it under the metadata as below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: appsody.dev/v1beta1
kind: AppsodyApplication
metadata:
  name: appsody-sample-springboot
  namespace: kabanero-samples
spec:
  # Add fields here
  version: 1.0.0
  applicationImage: appsody-sample-springboot
  stack: java-spring-boot2
  service:
    type: NodePort
    port: 8080
    annotations:
      prometheus.io/scrape: 'true'
      prometheus.io/path: '/actuator/prometheus'
  readinessProbe:
    failureThreshold: 12
    httpGet:
      path: /actuator/health
      port: 8080
    initialDelaySeconds: 5
    periodSeconds: 2
  livenessProbe:
    failureThreshold: 12
    httpGet:
      path: /actuator/liveness
      port: 8080
    initialDelaySeconds: 5
    periodSeconds: 2
  expose: true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_git_repo"><a class="anchor" href="#_creating_a_git_repo"></a>Creating a git repo</h3>
<div class="ulist">
<ul>
<li>
<p>Setup your git locally with the content of the application.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git init
git add .
git commit -m "initial commit"</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a github repository and push the code to the remote repository.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git remote add origin $GITHUB_REPOSITORY_URL
git push -u origin master</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_an_access_token"><a class="anchor" href="#_create_an_access_token"></a>Create an access token</h3>
<div class="ulist">
<ul>
<li>
<p>Go to Github <code>Settings</code>.</p>
</li>
<li>
<p>Select <code>Developer settings</code>.</p>
</li>
<li>
<p>Click on <code>Personal access tokens</code>.</p>
</li>
<li>
<p>Select <code>Generate new token</code>.</p>
</li>
<li>
<p>Create a Github access token with permission <code>admin:repo_hook</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_github_token.png" alt="sb lab1 github token">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Then finally click <code>Generate token</code> to create one.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details on how to generate Github personal access token refer <a href="https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line">Creating a personal access token</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configure_the_devops_pipeline"><a class="anchor" href="#_configure_the_devops_pipeline"></a>Configure the DevOps Pipeline</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_accessing_tekton_dashboard"><a class="anchor" href="#_accessing_tekton_dashboard"></a>Accessing Tekton dashboard</h3>
<div class="ulist">
<ul>
<li>
<p>Navigate to the menu in the upper left and select instances.</p>
</li>
<li>
<p>Then click the link under the <code>Tekton</code> label to navigate to the <code>Tekton Dashboard</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/tekton_link_42.png" alt="tekton link 42">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_tekton_dashboard.png" alt="sb lab1 tekton dashboard">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_tekton_webhook_for_git_repo"><a class="anchor" href="#_create_tekton_webhook_for_git_repo"></a>Create Tekton webhook for git repo</h3>
<div class="ulist">
<ul>
<li>
<p>Click on Webhooks in the menu.</p>
</li>
<li>
<p>Click on <code>Add Webhook</code>.</p>
</li>
<li>
<p>Enter the information for the Webhook settings.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_webhook_settings.png" alt="sb lab1 webhook settings">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Name - &lt;Name for webhook&gt;
Repository URL - &lt;Your github repository URL&gt;
Access Token - &lt;For this, you need to create a Github access token with permission `admin:repo_hook` or select one from the list&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For more information on how to configure github credentials, refer to <a href="tekton-credentials-github.html" class="page">Tekton - Configure GitHub Credentials</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new token as follows.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_webhook_settings_access_token_create.png" alt="sb lab1 webhook settings access token create">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can also use an existing token if it is already created.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_webhook_settings_access_token_existing.png" alt="sb lab1 webhook settings access token existing">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_set_up_the_pipeline"><a class="anchor" href="#_set_up_the_pipeline"></a>Set up the pipeline</h3>
<div class="ulist">
<ul>
<li>
<p>Enter the information for the Pipeline settings
NOTE: Replace &lt;your_project&gt; with the name of the target namespace in our case <code>kabanero-samples</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Namespace - kabanero
Pipeline - java-spring-boot2-build-deploy-pipeline
Service account - kabaner-operator
OCP 3.11 - Docker Registry - docker-registry.default.svc:5000/&lt;your_project&gt;
OCP 4.X - Docker Registry - image-registry.openshift-image-registry.svc:5000/&lt;your_project&gt;</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_pipeline_settings.png" alt="sb lab1 pipeline settings">
</div>
</div>
<div class="paragraph">
<p>Here, we are using the default docker registry that comes with the openshift cluster. Sometimes, you may need to configure a third party registry instead of using the default one. In order to do that, check out <a href="tekton-credentials-docker.html" class="page">Tekton - Configure External Docker Registry</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click Create, a new webhook is created.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_webhook.png" alt="sb lab1 webhook">
</div>
</div>
<div class="paragraph">
<p>Also, a new Gitub webhook is created on the project repository.</p>
</div>
<div class="paragraph">
<p>You can verify it by going into your <code>github repository &gt; Settings &gt; Webhooks</code> and you should be able to see the webhook created.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Replace &lt;your_project&gt; with the name of the target namespace in our case <code>kabanero-samples</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here, we are using the default pipeline. If you want to customize the pipeline, refer to <a href="https://www.ibm.com/support/knowledgecenter/SSCSJL_4.1.x/guides/guide-curating-pipelines/curating.html">Creating and updating tasks and pipelines</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_the_application"><a class="anchor" href="#_deploy_the_application"></a>Deploy the Application</h3>
<div class="paragraph">
<p>The way to deploy the application is to make a change in the application in the git repository to trigger the tekton webhook and start the DevOps pipeline to build and deploy the application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make a change to the application such as changing the <code>index.html</code> or any other things.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let us change the <code>title</code> from <code>Hello from Appsody!</code> to <code>Hello from Cloud Paks !!!</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Push your changes to the remote git repository.</p>
</li>
<li>
<p>This will trigger the Tekton Pipeline. To see the status of the Pipeline click on <code>PipelineRuns</code> on the menu of the dashboard.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_pipeline_runs.png" alt="sb lab1 pipeline runs">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>When the application is built and deployed the application will be available via the expose <code>Route</code>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_ocp_3_11_instructions"><a class="anchor" href="#_ocp_3_11_instructions"></a>OCP 3.11 Instructions</h4>
<div class="ulist">
<ul>
<li>
<p>Go to the OpenShift Console, switch to the project, and select <code>Applications &gt; Routes</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will see a route for your application, click on the url to open your application.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sb_lab1_application_route.png" alt="sb lab1 application route">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ocp_4_x_instructions"><a class="anchor" href="#_ocp_4_x_instructions"></a>OCP 4.X instructions</h4>
<div class="ulist">
<ul>
<li>
<p>Open the menu in the upper left of the OpenShift Console and navigate to Topology.</p>
</li>
<li>
<p>Select your Application in the center, and view the route(s) on the side.</p>
</li>
<li>
<p>Note: Please ensure you are in the developer role (should be default if following this guide)</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/dc_springboot_route.png" alt="dc springboot route">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Or you can also get the route from the oc CLI.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get route -n &lt;your_project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For instance,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get routes -n kabanero-samples
NAME                        HOST/PORT                                                                                                                                PATH      SERVICES                    PORT      TERMINATION   WILDCARD
appsody-sample-springboot   appsody-sample-springboot-kabanero-samples.ocp.example.com            appsody-sample-springboot   8080                    None</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now acccess the application at &lt;HOST/PORT&gt;, here it is <code>appsody-sample-springboot-kabanero-samples.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serverless_autoscaling_the_application_with_knative"><a class="anchor" href="#_serverless_autoscaling_the_application_with_knative"></a>Serverless autoscaling the Application with Knative</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_add_the_target_namespace_to_servicemeshmemberroll"><a class="anchor" href="#_add_the_target_namespace_to_servicemeshmemberroll"></a>Add the target namespace to ServiceMeshMemberRoll</h3>
<div class="ulist">
<ul>
<li>
<p>Edit the resource <code>smmr</code> :</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>oc edit smmr -n knative-serving-ingress</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Append the target namespace into the SMMR resource <code>spec</code> for example <code>kabanero-samples</code> leave any other namespaces already present:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>spec:
  members:
  - knative-serving
  - kabanero-samples</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify the namespace <code>kabanero-samples</code> was added by following this command:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get smmr default -n knative-serving-ingress -o jsonpath={.spec.members}

[knative-serving kabanero-samples]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_update_the_application_for_serverless"><a class="anchor" href="#_update_the_application_for_serverless"></a>Update the Application for Serverless</h3>
<div class="ulist">
<ul>
<li>
<p>Edit the file <code>app-deploy.yaml</code>.</p>
</li>
<li>
<p>Add the line <code>createKnativeService: true</code> to the spec object.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">apiVersion: appsody.dev/v1beta1
kind: AppsodyApplication
metadata:
  name: appsody-sample-springboot
  namespace: kabanero-samples
spec:
  createKnativeService: true</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Git push the change, and see tekton pipeline runs again.</p>
</li>
<li>
<p>Show the Knative resource</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get service.serving.knative.dev/appsody-sample-springboot

NAME                            URL                                                                                                                                            LATESTCREATED                         LATESTREADY                           READY     REASON
appsody-sample-springboot   http://appsody-sample-springboot.kabanero-samples.ocp.example.com  appsody-sample-springboot-mtl4q   appsody-sample-springboot-mtl4q   True</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Show the Knative route</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get route.serving.knative.dev/appsody-sample-springboot

NAME                            URL                                                                                                                                            READY     REASON
appsody-sample-springboot   http://appsody-sample-springboot.kabanero-samples.ocp.example.com  True</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Show the Knative configuration</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get configuration.serving.knative.dev/appsody-sample-springboot

NAME                            LATESTCREATED                         LATESTREADY                           READY     REASON
appsody-sample-springboot   appsody-sample-springboot-mtl4q   appsody-sample-springboot-mtl4q   True</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Show the Knative latest ready revision</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get revision.serving.knative.dev/appsody-sample-springboot-mtl4q

NAME                                  SERVICE NAME                          GENERATION   READY     REASON
appsody-sample-springboot-mtl4q   appsody-sample-springboot-mtl4q   2            True</pre>
</div>
</div>
<div class="paragraph">
<p>Visit the Knative public url <code><a href="http://appsody-sample-springboot.kabanero-samples.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud" class="bare">http://appsody-sample-springboot.kabanero-samples.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud</a></code> and list the pods</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods

NAME                                                              READY     STATUS    RESTARTS   AGE
appsody-sample-springboot-mtl4q-deployment-7bf6dbddf6-rr89p   2/2       Running   0          27s</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Wait 1 minute and you will then see the pods are not longer running</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get pods

No resources found.</pre>
</div>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
