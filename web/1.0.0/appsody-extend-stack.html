<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Appsody - Extending a Stack with Templates :: Learning-Kabanero-101</title>
    <link rel="canonical" href="https://github.com/ibm-cloud-architecture/Learning-Kabanero-101/web/1.0.0/appsody-extend-stack.html">
    <meta name="generator" content="Antora 2.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <p>Learning Kabanero 101</p>
      </div>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="web" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="kabanero-overview.html">Learning Kabanero 101</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="kabanero-overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Workflows</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="e2e-java-spring-boot2.html">E2E Java Spring Boot</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="e2e-java-microprofile.html">E2E Java Liberty Microprofile</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="e2e-nodejs-express.html">E2E Node.js Express</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tasks</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="codewind-setup-appsody.html">Configure CodeWind</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="appsody-extend-stack.html">Extend Appsody Stack</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tekton-create-pipeline.html">Extend Tekton Pipeline</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">External Resources</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://github.com/henrynash/apposody-stack-creation/blob/master/stack-creation.md" target="_blank" rel="noopener">Create Appsody Stack ↗</a></span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://github.com/gcharters/kabanero-dev-getting-started" target="_blank" rel="noopener">Java MicroProfile Tutorial ↗</a></span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="references.html">References</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Learning Kabanero 101</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Learning Kabanero 101</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="kabanero-overview.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="kabanero-overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="kabanero-overview.html">Learning Kabanero 101</a></li>
    <li>Tasks</li>
    <li><a href="appsody-extend-stack.html">Extend Appsody Stack</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/ibm-cloud-architecture/Learning-Kabanero-101/edit/master/modules/ROOT/pages/appsody-extend-stack.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1 class="page">Appsody - Extending a Stack with Templates</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_prerequisites">Prerequisites</a></li>
<li><a href="#_getting_started">Getting Started</a></li>
<li><a href="#_creating_a_new_stack_template">Creating a New Stack Template</a></li>
<li><a href="#_building_the_stack">Building the Stack</a></li>
<li><a href="#_adding_the_repository_to_appsody">Adding the Repository to Appsody</a></li>
<li><a href="#_running_the_application">Running the Application</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://cloud.ibm.com/kubernetes/catalog/openshiftcluster">Openshift Cluster</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.ibm.com/support/knowledgecenter/en/SSCSJL/install-icpa-cli.html">Kabenero Enterprise (Installed with IBM Cloud Pak for Applications)</a></p>
<div class="ulist">
<ul>
<li>
<p>Tekton Operator and TekTon Dashboard</p>
</li>
<li>
<p>Knative Operator</p>
</li>
</ul>
</div>
</li>
<li>
<p>Install Appsody Operator that watches on all namespaces <a href="https://github.com/appsody/appsody-operator/tree/master/deploy/releases/0.1.0" class="bare">https://github.com/appsody/appsody-operator/tree/master/deploy/releases/0.1.0</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Docker for Desktop - <a href="https://docs.docker.com/docker-for-mac/install/">Mac</a>, <a href="https://docs.docker.com/docker-for-windows/install/">Windows</a></p>
</li>
<li>
<p>The following command line (CLI) tools and configured:</p>
<div class="ulist">
<ul>
<li>
<p>docker - It comes with the Docker for Desktop installation.</p>
</li>
<li>
<p><a href="https://www.okd.io/download.html">oc</a></p>
</li>
<li>
<p><a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git">git</a></p>
</li>
<li>
<p><a href="https://appsody.dev/docs/getting-started/installation">appsody</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First we need to clone the stacks repository provided by appsody.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git clone https://github.com/appsody/stacks.git
cd stacks</code></pre>
</div>
</div>
<div class="paragraph">
<p>The stacks repository provides us with all the stacks provided by Appsody as well as a sample stack in the <code>/samples/sample-stack</code> directory.  The <code>sample stack</code> directory gives us the basic skeleton for starting a stack from scratch.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_a_new_stack_template"><a class="anchor" href="#_creating_a_new_stack_template"></a>Creating a New Stack Template</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For this walkthrough however we are going to create a new stack template based on an existing template.  In this case we are going to modify the <code>nodejs-express</code> stack&#8217;s <code>simple</code> template.  We are going to modify the <code>app.js</code> and the <code>README.md</code> files.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start by navigating to the <code>nodejs-express simple template</code> directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd incubator/nodejs-express/templates</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can copy the simple template into a new directory, to create a new template.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp -r simple/ simple-sample
cd simple-sample</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once in the simple-sample directory. Open the <code>App.js</code> file and add the following code to create a new endpoint for the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-node hljs" data-lang="node">app.get('/test', (req, res) =&gt; {
  res.send("Testing a new Template in Appsody!!");
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save the file and now we need to create a <code>README</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">touch README.md</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, add some content to <code>README</code> file. Copy and paste the following into the <code>README</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-markdown hljs" data-lang="markdown"># Simple-Sample Template

This template uses Node.js with express.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save the file and thats it for the changes for the template.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_the_stack"><a class="anchor" href="#_building_the_stack"></a>Building the Stack</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now it&#8217;s time to add the new template into the stack. All we need to do is run the following command to start the build process.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./ci/build.sh . incubator/nodejs-express</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Build Errors</div>
<div class="listingblock">
<div class="content">
<pre>If you run into the following error:

&gt; appsody run -P --name nodejs-express-simple
simple-sample
skaffold

Waiting for container to start
grep: simple-sample: No such file or directory
grep: skaffold: No such file or directory
.grep: simple-sample: No such file or directory
grep: skaffold: No such file or directory
.grep: simple-sample: No such file or directory
grep: skaffold: No such file or directory</pre>
</div>
</div>
<div class="paragraph">
<p>You can stop the build script with <code>control+c</code> and continue through the tutorial.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_the_repository_to_appsody"><a class="anchor" href="#_adding_the_repository_to_appsody"></a>Adding the Repository to Appsody</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once the building of the new template is completed, we need to add the custom repository to appsody for it to run.</p>
</div>
<div class="paragraph">
<p>First lets check to see what repositories are currently available.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody list</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/extend_stack_app_list.png" alt="extend stack app list">
</div>
</div>
<div class="paragraph">
<p>Next we need to add the repository to the list by runnning:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody repo add custom-stack &lt;URL to the Stack incubator-index-local.yaml&gt;</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/extend_stack_app_code.png" alt="extend stack app code">
</div>
</div>
<div class="paragraph">
<p>Verify that the addition of the stack was successful by re-running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody list</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/extend_stack_custom.png" alt="extend stack custom">
</div>
</div>
<div class="paragraph">
<p>Now we are ready to run the application using the new template.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_the_application"><a class="anchor" href="#_running_the_application"></a>Running the Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run the application we need to create a new directory and create a new appsody application inside it using the custom template.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir custom-nodejs
cd custom-nodejs
appsody init custom-stack/nodejs-express simple-sample</code></pre>
</div>
</div>
<div class="paragraph">
<p>A new application will be pulled and built into the new directory for you to be able to run.</p>
</div>
<div class="paragraph">
<p>Once the building is complete you can run the application with the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody run</code></pre>
</div>
</div>
<div class="paragraph">
<p>A new instance of the application will start in a docker container and you can see your updated applcation code by navigating to <a href="http://localhost:3000/test" class="bare">http://localhost:3000/test</a> in your web browser</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/extend_stack_appsody_running.png" alt="extend stack appsody running">
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
