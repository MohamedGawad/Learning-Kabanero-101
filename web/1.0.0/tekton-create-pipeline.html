<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tekton - Create a Pipeline :: Learning-Kabanero-101</title>
    <link rel="canonical" href="https://github.com/ibm-cloud-architecture/Learning-Kabanero-101/web/1.0.0/tekton-create-pipeline.html">
    <meta name="generator" content="Antora 2.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <p>Learning Kabanero 101</p>
      </div>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="web" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="kabanero-overview.html">Learning Kabanero 101</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="kabanero-overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Workflows</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="e2e-java-spring-boot2.html">E2E Java Spring Boot</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="e2e-java-microprofile.html">E2E Java Liberty Microprofile</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="e2e-nodejs-express.html">E2E Node.js Express</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tasks</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="codewind-setup-appsody.html">Configure CodeWind</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="appsody-extend-stack.html">Extend Appsody Stack</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="tekton-create-pipeline.html">Extend Tekton Pipeline</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">External Resources</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://github.com/henrynash/apposody-stack-creation/blob/master/stack-creation.md" target="_blank" rel="noopener">Create Appsody Stack ↗</a></span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text"><a href="https://github.com/gcharters/kabanero-dev-getting-started" target="_blank" rel="noopener">Java MicroProfile Tutorial ↗</a></span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="references.html">References</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Learning Kabanero 101</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Learning Kabanero 101</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="kabanero-overview.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="kabanero-overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="kabanero-overview.html">Learning Kabanero 101</a></li>
    <li>Tasks</li>
    <li><a href="tekton-create-pipeline.html">Extend Tekton Pipeline</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/ibm-cloud-architecture/Learning-Kabanero-101/edit/master/modules/ROOT/pages/tekton-create-pipeline.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1 class="page">Tekton - Create a Pipeline</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_prerequisites">Prerequisites</a>
<ul class="sectlevel2">
<li><a href="#_nodejs_express">Nodejs express</a></li>
<li><a href="#_java_sprinboot">Java Sprinboot</a></li>
<li><a href="#_java_microprofile">Java Microprofile</a></li>
</ul>
</li>
<li><a href="#_create_a_pipeline">Create a Pipeline</a></li>
<li><a href="#_nodejs_express_2">Nodejs express</a>
<ul class="sectlevel2">
<li><a href="#_custom_task">Custom Task</a></li>
<li><a href="#_custom_pipeline">Custom Pipeline</a></li>
<li><a href="#_create_a_webhook">Create a webhook</a></li>
<li><a href="#_verify_the_pipeline">Verify the pipeline</a></li>
</ul>
</li>
<li><a href="#_java_springboot">Java Springboot</a>
<ul class="sectlevel2">
<li><a href="#_custom_task_2">Custom Task</a></li>
<li><a href="#_custom_pipeline_2">Custom Pipeline</a></li>
<li><a href="#_create_a_webhook_2">Create a webhook</a></li>
<li><a href="#_verify_the_pipeline_2">Verify the pipeline</a></li>
</ul>
</li>
<li><a href="#_java_microprofile_2">Java Microprofile</a>
<ul class="sectlevel2">
<li><a href="#_custom_task_3">Custom Task</a></li>
<li><a href="#_custom_pipeline_3">Custom Pipeline</a></li>
<li><a href="#_create_a_webhook_3">Create a webhook</a></li>
<li><a href="#_verify_the_pipeline_3">Verify the pipeline</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_nodejs_express"><a class="anchor" href="#_nodejs_express"></a>Nodejs express</h3>
<div class="ulist">
<ul>
<li>
<p>You need to create an appsody sample application and configure the tekton pipeline.</p>
<div class="ulist">
<ul>
<li>
<p>For instructions on how to create a nodejs express appsody sample, checkout <a href="e2e-nodejs-express.html#_create_a_new_application" class="page">Create a new appsody nodejs express application</a>.</p>
</li>
<li>
<p>For instructions on how to deploy nodejs express application on openshift, checkout <a href="e2e-nodejs-express.html#_deploy_the_appsody_application_on_openshift_for_team_development" class="page">Deploy the appsody application on Openshift</a>.</p>
</li>
<li>
<p>For instructions on how to access tekton pipeline, checkout <a href="e2e-nodejs-express.html#_accessing_tekton_dashboard" class="page">Accessing Tekton dashboard</a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_java_sprinboot"><a class="anchor" href="#_java_sprinboot"></a>Java Sprinboot</h3>
<div class="ulist">
<ul>
<li>
<p>You need to create an appsody sample application and configure the tekton pipeline.</p>
<div class="ulist">
<ul>
<li>
<p>For instructions on how to create a java springboot appsody sample, checkout <a href="e2e-java-spring-boot2.html#_create_a_new_application" class="page">Create a new appsody java springboot express application</a>.</p>
</li>
<li>
<p>For instructions on how to deploy java springboot application on openshift, checkout <a href="e2e-java-spring-boot2.html#_deploy_the_appsody_application_on_openshift_for_team_development" class="page">Deploy the appsody application on Openshift</a>.</p>
</li>
<li>
<p>For instructions on how to access tekton pipeline, checkout <a href="e2e-java-spring-boot2.html#_accessing_tekton_dashboard" class="page">Accessing Tekton dashboard</a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_java_microprofile"><a class="anchor" href="#_java_microprofile"></a>Java Microprofile</h3>
<div class="ulist">
<ul>
<li>
<p>You need to create an appsody sample application and configure the tekton pipeline.</p>
<div class="ulist">
<ul>
<li>
<p>For instructions on how to create a java microprofile appsody sample, checkout <a href="e2e-java-microprofile.html#_create_a_new_application" class="page">Create a new appsody java microprofile application</a>.</p>
</li>
<li>
<p>For instructions on how to deploy java microprofile application on openshift, checkout <a href="e2e-java-microprofile.html#_deploy_the_appsody_application_on_openshift_for_team_development" class="page">Deploy the appsody application on Openshift</a>.</p>
</li>
<li>
<p>For instructions on how to access tekton pipeline, checkout <a href="e2e-java-microprofile.html#_accessing_tekton_dashboard" class="page">Accessing Tekton dashboard</a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_a_pipeline"><a class="anchor" href="#_create_a_pipeline"></a>Create a Pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With kabanero, every collection comes with a default <code>build task</code>, <code>deploy task</code> and <code>build deploy pipeline</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run this command to see the available pipelines.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pipeline</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something similar to this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get pipeline
NAME                                           AGE
java-microprofile-build-deploy-pipeline        15d
java-spring-boot2-build-deploy-pipeline        15d
nodejs-build-deploy-pipeline                   15d
nodejs-express-build-deploy-pipeline           15d
nodejs-loopback-build-deploy-pipeline          15d
pipeline0                                      15d</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also access them on the tekton dashboard.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_lab1_tekton_home.png" alt="sb lab1 tekton home">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To see the available tasks, use this command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get task</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something similar to this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get task
NAME                             AGE
collections-build-task           13d
java-microprofile-build-task     15d
java-microprofile-deploy-task    15d
java-spring-boot2-build-task     15d
java-spring-boot2-deploy-task    15d
monitor-result-task              15d
nodejs-build-task                15d
nodejs-deploy-task               15d
nodejs-express-build-task        15d
nodejs-express-deploy-task       15d
nodejs-loopback-build-task       15d
nodejs-loopback-deploy-task      15d
pipeline0-task                   15d</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let us now see how to define more tasks or create new pipelines for appsody sample applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_nodejs_express_2"><a class="anchor" href="#_nodejs_express_2"></a>Nodejs express</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before defining a new task or pipeline, make sure, you do the following steps.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a Nodejs express appsody sample application.</p>
</li>
<li>
<p>Push the code to a github repo.</p>
</li>
<li>
<p>Create a github access token.</p>
</li>
<li>
<p>Access tekton dashboard.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you did not perform any of the above steps, go to the links provided in the prerequisites.</p>
</div>
<div class="sect2">
<h3 id="_custom_task"><a class="anchor" href="#_custom_task"></a>Custom Task</h3>
<div class="paragraph">
<p>Let us include <code>npm test</code> as one of the steps in our new task along with the ones that come by default.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In this task, we are adding the below step additionally to the ones that come by default.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">- name: npm-test
  securityContext:
    privileged: true
  image: kabanero/nodejs-express:0.2
  command: ["/bin/bash","-c","cd extracted/user-app &amp;&amp; ls &amp;&amp; npm install --prefix user-app &amp;&amp; npm install -g mocha &amp;&amp; cd .. &amp;&amp; npm test &amp;&amp; npm test --prefix user-app"]
  env:
    - name: gitsource
      value: git-source
  volumeMounts:
    - mountPath: /var/lib/containers
      name: varlibcontainers</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To do this, create <code>test-build-task.yaml</code> as follows.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: tekton.dev/v1alpha1
kind: Task
metadata:
  name: nodejs-express-test-build-task
spec:
  inputs:
    resources:
      - name: git-source
        type: git
    params:
      - name: pathToDockerFile
        default: /workspace/extracted/Dockerfile
      - name: pathToContext
        default: /workspace/extracted
  outputs:
    resources:
      - name: docker-image
        type: image
  steps:
    - name: assemble-extract
      securityContext:
        privileged: true
      image: appsody/appsody-buildah
      command: ["/bin/bash"]
      args:
        - -c
        - "/extract.sh"
      env:
        - name: gitsource
          value: git-source
      volumeMounts:
        - mountPath: /var/lib/containers
          name: varlibcontainers
    - name: npm-test
      securityContext:
        privileged: true
      image: kabanero/nodejs-express:0.2
      command: ["/bin/bash","-c","cd extracted/user-app &amp;&amp; ls &amp;&amp; npm install --prefix user-app &amp;&amp; npm install -g mocha &amp;&amp; cd .. &amp;&amp; npm test &amp;&amp; npm test --prefix user-app"]
      env:
        - name: gitsource
          value: git-source
      volumeMounts:
        - mountPath: /var/lib/containers
          name: varlibcontainers
    - name: build-bud
      securityContext:
        privileged: true
      image: appsody/appsody-buildah
      command: ['buildah', 'bud', '--tls-verify=false', '--format=docker', '-f', '${inputs.params.pathToDockerFile}', '-t', '${outputs.resources.docker-image.url}', '${inputs.params.pathToContext}']
      env:
        - name: gitsource
          value: git-source
      volumeMounts:
        - mountPath: /var/lib/containers
          name: varlibcontainers
    - name: build-push
      securityContext:
        privileged: true
      image: appsody/appsody-buildah
      command: ['buildah', 'push', '--tls-verify=false', '${outputs.resources.docker-image.url}', 'docker://${outputs.resources.docker-image.url}']
      env:
        - name: gitsource
          value: git-source
      volumeMounts:
        - mountPath: /var/lib/containers
          name: varlibcontainers
  volumes:
    - name: varlibcontainers
      emptyDir: {}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once you create this yaml, create a task in <code>kabanero</code> namespace as follows.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc create -f test-build-task.yaml -n kabanero</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you created it successfully, you will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc create -f test-build-task.yaml -n kabanero
task.tekton.dev/nodejs-express-test-build-task created</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify it by using the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get task
NAME                             AGE
collections-build-task           13d
java-microprofile-build-task     15d
java-microprofile-deploy-task    15d
java-spring-boot2-build-task     15d
java-spring-boot2-deploy-task    15d
monitor-result-task              15d
nodejs-build-task                15d
nodejs-deploy-task               15d
nodejs-express-build-task        15d
nodejs-express-deploy-task       15d
nodejs-express-test-build-task   1h
nodejs-loopback-build-task       15d
nodejs-loopback-deploy-task      15d
pipeline0-task                   15d</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_custom_pipeline"><a class="anchor" href="#_custom_pipeline"></a>Custom Pipeline</h3>
<div class="paragraph">
<p>Let us now create a new pipeline that includes the task we created earlier. We are replacing the default <code>build task</code> with the previous task in the new pipeline.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create <code>nodejs-express-test-build-deploy-pipeline.yaml</code> as follows.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: tekton.dev/v1alpha1
kind: Pipeline
metadata:
  name: nodejs-express-test-build-deploy-pipeline
spec:
  resources:
    - name: git-source
      type: git
    - name: docker-image
      type: image
  tasks:
    - name: nodejs-express-test-build-task
      taskRef:
        name: nodejs-express-test-build-task
      resources:
        inputs:
        - name: git-source
          resource: git-source
        outputs:
        - name: docker-image
          resource: docker-image
    - name: deploy-task
      taskRef:
        name: nodejs-express-deploy-task
      runAfter: [nodejs-express-test-build-task]
      resources:
        inputs:
        - name: git-source
          resource: git-source
        - name: docker-image
          resource: docker-image</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once you create this yaml, create a new pipeline in <code>kabanero</code> namespace as follows.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc create -f nodejs-express-test-build-deploy-pipeline.yaml -n kabanero</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you created it successfully, you will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc create -f nodejs-express-test-build-deploy-pipeline.yaml -n kabanero
pipeline.tekton.dev/nodejs-express-test-build-deploy-pipeline created</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify it by using the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get pipeline
NAME                                           AGE
java-microprofile-build-deploy-pipeline        15d
java-spring-boot2-build-deploy-pipeline        15d
nodejs-build-deploy-pipeline                   15d
nodejs-express-build-deploy-pipeline           15d
nodejs-express-test-build-deploy-pipeline      1h
nodejs-loopback-build-deploy-pipeline          15d
pipeline0                                      15d</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_webhook"><a class="anchor" href="#_create_a_webhook"></a>Create a webhook</h3>
<div class="ulist">
<ul>
<li>
<p>Access the tekton dashboard and now you should be able to see the new pipeline in the list.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_custom_pipeline_tekton_home.png" alt="sb custom pipeline tekton home">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure the github webhook to your repo. Go to <code>Webhooks</code> &gt; <code>Add Webhook</code> and then create the webhook.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_custom_pipeline_tekton_webhook.png" alt="sb custom pipeline tekton webhook">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify if it is created successfully.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_custom_pipeline_tekton_webhooks.png" alt="sb custom pipeline tekton webhooks">
</div>
</div>
<div class="paragraph">
<p>For more detailed instructions on how to create webhook, refer <a href="e2e-nodejs-express.html#_create_tekton_webhook_for_git_repo" class="page">Create Tekton webhook for git repo</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_verify_the_pipeline"><a class="anchor" href="#_verify_the_pipeline"></a>Verify the pipeline</h3>
<div class="ulist">
<ul>
<li>
<p>Make any changes to your app and push it to github.</p>
</li>
<li>
<p>This will trigger the tekton pipleine.</p>
</li>
<li>
<p>Go to the tekton dashboard and access the new pipeline we created.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_custom_pipeline_tekton_home.png" alt="sb custom pipeline tekton home">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Wait till the task is completed and then click on the Pipeline Run.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_custom_pipeline_tekton_pipeline_run.png" alt="sb custom pipeline tekton pipeline run">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once the tasks are all completed, you will see something like below.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_custom_pipeline_tekton_pipeline_run_tasks.png" alt="sb custom pipeline tekton pipeline run tasks">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_java_springboot"><a class="anchor" href="#_java_springboot"></a>Java Springboot</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before defining a new task or pipeline, make sure, you do the following steps.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a java springboot appsody sample application.</p>
</li>
<li>
<p>Push the code to a github repo.</p>
</li>
<li>
<p>Create a github access token.</p>
</li>
<li>
<p>Access tekton dashboard.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you did not perform any of the above steps, go to the links provided in the prerequisites.</p>
</div>
<div class="sect2">
<h3 id="_custom_task_2"><a class="anchor" href="#_custom_task_2"></a>Custom Task</h3>
<div class="paragraph">
<p>Let us include <code>mvn test</code> as one of the steps in our new task along with the ones that come by default.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In this task, we are adding the below step additionally to the ones that come by default.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">- name: mvn-test
  securityContext:
    privileged: true
  image: kabanero/java-spring-boot2:0.3
  command: ["/bin/bash","-c","cd extracted &amp;&amp; mvn test -f appsody-boot2-pom.xml"]
  env:
    - name: gitsource
      value: git-source
  volumeMounts:
    - mountPath: /var/lib/containers
      name: varlibcontainers</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To do this, create <code>test-build-task.yaml</code> as follows.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: tekton.dev/v1alpha1
kind: Task
metadata:
  name: java-spring-boot2-test-build-task
spec:
  inputs:
    resources:
      - name: git-source
        type: git
    params:
      - name: pathToDockerFile
        default: /workspace/extracted/Dockerfile
      - name: pathToContext
        default: /workspace/extracted
  outputs:
    resources:
      - name: docker-image
        type: image
  steps:
    - name: assemble-extract
      securityContext:
        privileged: true
      image: appsody/appsody-buildah
      command: ["/bin/bash"]
      args:
        - -c
        - "/extract.sh"
      env:
        - name: gitsource
          value: git-source
      volumeMounts:
        - mountPath: /var/lib/containers
          name: varlibcontainers
    - name: mvn-test
      securityContext:
        privileged: true
      image: kabanero/java-spring-boot2:0.3
      command: ["/bin/bash","-c","cd extracted &amp;&amp; mvn test -f appsody-boot2-pom.xml"]
      env:
        - name: gitsource
          value: git-source
      volumeMounts:
        - mountPath: /var/lib/containers
          name: varlibcontainers
    - name: build-bud
      securityContext:
        privileged: true
      image: appsody/appsody-buildah
      command: ['buildah', 'bud', '--tls-verify=false', '--format=docker', '-f', '${inputs.params.pathToDockerFile}', '-t', '${outputs.resources.docker-image.url}', '${inputs.params.pathToContext}']
      env:
        - name: gitsource
          value: git-source
      volumeMounts:
        - mountPath: /var/lib/containers
          name: varlibcontainers
    - name: build-push
      securityContext:
        privileged: true
      image: appsody/appsody-buildah
      command: ['buildah', 'push', '--tls-verify=false', '${outputs.resources.docker-image.url}', 'docker://${outputs.resources.docker-image.url}']
      env:
        - name: gitsource
          value: git-source
      volumeMounts:
        - mountPath: /var/lib/containers
          name: varlibcontainers
  volumes:
    - name: varlibcontainers
      emptyDir: {}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once you create this yaml, create a task in <code>kabanero</code> namespace as follows.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc create -f test-build-task.yaml -n kabanero</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you created it successfully, you will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc create -f test-build-task.yaml -n kabanero
task.tekton.dev/java-spring-boot2-test-build-task created</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify it by using the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get task
NAME                                AGE
collections-build-task              13d
java-microprofile-build-task        15d
java-microprofile-deploy-task       15d
java-spring-boot2-build-task        15d
java-spring-boot2-deploy-task       15d
java-spring-boot2-test-build-task   9m
monitor-result-task                 15d
nodejs-build-task                   15d
nodejs-deploy-task                  15d
nodejs-express-build-task           15d
nodejs-express-deploy-task          15d
nodejs-express-test-build-task      2h
nodejs-loopback-build-task          15d
nodejs-loopback-deploy-task         15d
pipeline0-task                      15d</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_custom_pipeline_2"><a class="anchor" href="#_custom_pipeline_2"></a>Custom Pipeline</h3>
<div class="paragraph">
<p>Let us now create a new pipeline that includes the task we created earlier. We are replacing the default <code>build task</code> with the previous task in the new pipeline.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create <code>java-spring-boot2-build-deploy-pipeline.yaml</code> as follows.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: tekton.dev/v1alpha1
kind: Pipeline
metadata:
  name: java-spring-boot2-test-build-deploy-pipeline
spec:
  resources:
    - name: git-source
      type: git
    - name: docker-image
      type: image
  tasks:
    - name: java-spring-boot2-test-build-task
      taskRef:
        name: java-spring-boot2-test-build-task
      resources:
        inputs:
        - name: git-source
          resource: git-source
        outputs:
        - name: docker-image
          resource: docker-image
    - name: deploy-task
      taskRef:
        name: java-spring-boot2-deploy-task
      runAfter: [java-spring-boot2-test-build-task]
      resources:
        inputs:
        - name: git-source
          resource: git-source
        - name: docker-image
          resource: docker-image</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once you create this yaml, create a new pipeline in <code>kabanero</code> namespace as follows.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc create -f java-spring-boot2-build-deploy-pipeline.yaml -n kabanero</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you created it successfully, you will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc create -f java-spring-boot2-build-deploy-pipeline.yaml -n kabanero
pipeline.tekton.dev/java-spring-boot2-test-build-deploy-pipeline created</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify it by using the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get pipeline
NAME                                           AGE
java-microprofile-build-deploy-pipeline        15d
java-spring-boot2-build-deploy-pipeline        15d
java-spring-boot2-test-build-deploy-pipeline   37m
nodejs-build-deploy-pipeline                   15d
nodejs-express-build-deploy-pipeline           15d
nodejs-express-test-build-deploy-pipeline      2h
nodejs-loopback-build-deploy-pipeline          15d
pipeline0                                      15d</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_webhook_2"><a class="anchor" href="#_create_a_webhook_2"></a>Create a webhook</h3>
<div class="ulist">
<ul>
<li>
<p>Access the tekton dashboard and now you should be able to see the new pipeline in the list.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_custom_pipeline_tekton_java_sb2.png" alt="sb custom pipeline tekton java sb2">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure the github webhook to your repo. Go to <code>Webhooks</code> &gt; <code>Add Webhook</code> and then create the webhook.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_custom_pipeline_tekton_webhook_java_sb2.png" alt="sb custom pipeline tekton webhook java sb2">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify if it is created successfully.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_custom_pipeline_tekton_webhooks_java_sb2.png" alt="sb custom pipeline tekton webhooks java sb2">
</div>
</div>
<div class="paragraph">
<p>For more detailed instructions on how to create webhook, refer <a href="e2e-java-spring-boot2.html#_create_tekton_webhook_for_git_repo" class="page">Create Tekton webhook for git repo</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_verify_the_pipeline_2"><a class="anchor" href="#_verify_the_pipeline_2"></a>Verify the pipeline</h3>
<div class="ulist">
<ul>
<li>
<p>Make any changes to your app and push it to github.</p>
</li>
<li>
<p>This will trigger the tekton pipleine.</p>
</li>
<li>
<p>Go to the tekton dashboard and access the new pipeline we created.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_custom_pipeline_tekton_java_sb2.png" alt="sb custom pipeline tekton java sb2">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Wait till the task is completed and then click on the Pipeline Run.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_custom_pipeline_task_java_sb2.png" alt="sb custom pipeline task java sb2">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once the tasks are all completed, you will see something like below.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/sb_custom_pipeline_tekton_pipeline_run_tasks_java.png" alt="sb custom pipeline tekton pipeline run tasks java">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, the <code>buildahbud</code> step fails due to the absence of JDK version as it got deleted. The issue is tracked <a href="https://github.com/kabanero-io/collections/issues/97">here</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For java-spring-boot2, <code>mvn test</code> only works on the pom defined for stack and it fails on the application pom. The issue is tracked <a href="https://github.com/kabanero-io/collections/issues/96">here</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_java_microprofile_2"><a class="anchor" href="#_java_microprofile_2"></a>Java Microprofile</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before defining a new task or pipeline, make sure, you do the following steps.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a java microprofile appsody sample application.</p>
</li>
<li>
<p>Push the code to a github repo.</p>
</li>
<li>
<p>Create a github access token.</p>
</li>
<li>
<p>Access tekton dashboard.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you did not perform any of the above steps, go to the links provided in the prerequisites.</p>
</div>
<div class="sect2">
<h3 id="_custom_task_3"><a class="anchor" href="#_custom_task_3"></a>Custom Task</h3>
<div class="paragraph">
<p>Let us include <code>mvn test</code> as one of the steps in our new task along with the ones that come by default.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In this task, we are adding the below step additionally to the ones that come by default.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">- name: mvn-test
  securityContext:
    privileged: true
  image: kabanero/java-microprofile:0.2
  command: ["/bin/bash","-c","cd extracted &amp;&amp; mvn test"]
  env:
    - name: gitsource
      value: git-source
  volumeMounts:
    - mountPath: /var/lib/containers
      name: varlibcontainers</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To do this, create <code>test-build-task.yaml</code> as follows.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: tekton.dev/v1alpha1
kind: Task
metadata:
  name: java-microprofile-test-build-task
spec:
  inputs:
    resources:
      - name: git-source
        type: git
    params:
      - name: pathToDockerFile
        default: /workspace/extracted/Dockerfile
      - name: pathToContext
        default: /workspace/extracted
  outputs:
    resources:
      - name: docker-image
        type: image
  steps:
    - name: assemble-extract
      securityContext:
        privileged: true
      image: appsody/appsody-buildah
      command: ["/bin/bash"]
      args:
        - -c
        - "/extract.sh"
      env:
        - name: gitsource
          value: git-source
      volumeMounts:
        - mountPath: /var/lib/containers
          name: varlibcontainers
    - name: mvn-test
      securityContext:
        privileged: true
      image: kabanero/java-microprofile:0.2
      command: ["/bin/bash","-c","cd extracted &amp;&amp; mvn test"]
      env:
        - name: gitsource
          value: git-source
      volumeMounts:
        - mountPath: /var/lib/containers
          name: varlibcontainers
    - name: build-bud
      securityContext:
        privileged: true
      image: appsody/appsody-buildah
      command: ['buildah', 'bud', '--tls-verify=false', '--format=docker', '-f', '${inputs.params.pathToDockerFile}', '-t', '${outputs.resources.docker-image.url}', '${inputs.params.pathToContext}']
      env:
        - name: gitsource
          value: git-source
      volumeMounts:
        - mountPath: /var/lib/containers
          name: varlibcontainers
    - name: build-push
      securityContext:
        privileged: true
      image: appsody/appsody-buildah
      command: ['buildah', 'push', '--tls-verify=false', '${outputs.resources.docker-image.url}', 'docker://${outputs.resources.docker-image.url}']
      env:
        - name: gitsource
          value: git-source
      volumeMounts:
        - mountPath: /var/lib/containers
          name: varlibcontainers
  volumes:
    - name: varlibcontainers
      emptyDir: {}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once you create this yaml, create a task in <code>kabanero</code> namespace as follows.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc create -f test-build-task.yaml -n kabanero</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you created it successfully, you will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc create -f test-build-task.yaml
task.tekton.dev/java-microprofile-test-build-task created</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify it by using the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get task
NAME                                AGE
collections-build-task              13d
java-microprofile-build-task        16d
java-microprofile-deploy-task       16d
java-microprofile-test-build-task   23m
java-spring-boot2-build-task        16d
java-spring-boot2-deploy-task       16d
java-spring-boot2-test-build-task   1h
monitor-result-task                 16d
nodejs-build-task                   16d
nodejs-deploy-task                  16d
nodejs-express-build-task           16d
nodejs-express-deploy-task          16d
nodejs-express-test-build-task      21h
nodejs-loopback-build-task          16d
nodejs-loopback-deploy-task         16d
pipeline0-task                      16d</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_custom_pipeline_3"><a class="anchor" href="#_custom_pipeline_3"></a>Custom Pipeline</h3>
<div class="paragraph">
<p>Let us now create a new pipeline that includes the task we created earlier. We are replacing the default <code>build task</code> with the previous task in the new pipeline.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create <code>java-microprofile-test-build-deploy-pipeline.yaml</code> as follows.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: tekton.dev/v1alpha1
kind: Pipeline
metadata:
  name: java-microprofile-test-build-deploy-pipeline
spec:
  resources:
    - name: git-source
      type: git
    - name: docker-image
      type: image
  tasks:
    - name: build-task
      taskRef:
        name: java-microprofile-test-build-task
      resources:
        inputs:
        - name: git-source
          resource: git-source
        outputs:
        - name: docker-image
          resource: docker-image
    - name: deploy-task
      taskRef:
        name: java-microprofile-deploy-task
      runAfter: [build-task]
      resources:
        inputs:
        - name: git-source
          resource: git-source
        - name: docker-image
          resource: docker-image</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once you create this yaml, create a new pipeline in <code>kabanero</code> namespace as follows.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc create -f java-microprofile-test-build-deploy-pipeline.yaml -n kabanero</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you created it successfully, you will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc create -f java-microprofile-test-build-deploy-pipeline.yaml -n kabanero
pipeline.tekton.dev/java-microprofile-test-build-deploy-pipeline created</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify it by using the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get pipeline
NAME                                           AGE
java-microprofile-build-deploy-pipeline        16d
java-microprofile-test-build-deploy-pipeline   27m
java-spring-boot2-build-deploy-pipeline        16d
java-spring-boot2-test-build-deploy-pipeline   13h
nodejs-build-deploy-pipeline                   16d
nodejs-express-build-deploy-pipeline           16d
nodejs-express-test-build-deploy-pipeline      21h
nodejs-loopback-build-deploy-pipeline          16d
pipeline0                                      16d</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_webhook_3"><a class="anchor" href="#_create_a_webhook_3"></a>Create a webhook</h3>
<div class="ulist">
<ul>
<li>
<p>Access the tekton dashboard and now you should be able to see the new pipeline in the list.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/mp_custom_pipeline_tekton.png" alt="mp custom pipeline tekton">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure the github webhook to your repo. Go to <code>Webhooks</code> &gt; <code>Add Webhook</code> and then create the webhook.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/mp_custom_pipeline_tekton_webhook.png" alt="mp custom pipeline tekton webhook">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Verify if it is created successfully.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/mp_custom_pipeline_tekton_webhooks.png" alt="mp custom pipeline tekton webhooks">
</div>
</div>
<div class="paragraph">
<p>For more detailed instructions on how to create webhook, refer <a href="e2e-java-microprofile.html#_create_tekton_webhook_for_git_repo" class="page">Create Tekton webhook for git repo</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_verify_the_pipeline_3"><a class="anchor" href="#_verify_the_pipeline_3"></a>Verify the pipeline</h3>
<div class="ulist">
<ul>
<li>
<p>Make any changes to your app and push it to github.</p>
</li>
<li>
<p>This will trigger the tekton pipleine.</p>
</li>
<li>
<p>Go to the tekton dashboard and access the new pipeline we created.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/mp_custom_pipeline_tekton.png" alt="mp custom pipeline tekton">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Wait till the task is completed and then click on the Pipeline Run.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/mp_custom_pipeline_task.png" alt="mp custom pipeline task">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once the tasks are all completed, you will see something like below.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/mp_custom_pipeline_tekton_pipeline_run_tasks.png" alt="mp custom pipeline tekton pipeline run tasks">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, the <code>buildahbud</code> step fails due to the absence of JDK version as it got deleted. The issue is tracked <a href="https://github.com/kabanero-io/collections/issues/97">here</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For java-spring-boot2, <code>mvn test</code> only works on the pom defined for stack and it fails on the application pom. The issue is tracked <a href="https://github.com/kabanero-io/collections/issues/96">here</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
