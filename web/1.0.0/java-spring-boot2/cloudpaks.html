<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>End to end Spring Boot Kabanero workflow :: Learning-Kabanero-101</title>
    <link rel="canonical" href="https://github.com/ibm-cloud-architecture/Learning-Kabanero-101/web/1.0.0/java-spring-boot2/cloudpaks.html">
    <meta name="generator" content="Antora 2.0.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <p>Learning Kabanero 101</p>
      </div>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="web" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../kabanero/kabanero-overview.html">Learning Kabanero 101</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../kabanero/kabanero-overview.html">Overview</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="cloudpaks.html">E2E Spring Boot</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../java-microprofile/java-microprofile.html">E2E Java Microprofile</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../nodejs-express/nodejs-express.html">E2E Node.js Express</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../tekton/create-pipeline.html">Create Tekton Pipeline</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appsody/create-stack.html">Create Appsody Stack</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../codewind/setup_codewind_appsody.html">Configure CodeWind</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Learning Kabanero 101</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Learning Kabanero 101</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../kabanero/kabanero-overview.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../kabanero/kabanero-overview.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../kabanero/kabanero-overview.html">Learning Kabanero 101</a></li>
    <li><a href="cloudpaks.html">E2E Spring Boot</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/ibm-cloud-architecture/Learning-Kabanero-101/edit/master/modules/ROOT/pages/java-spring-boot2/cloudpaks.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1 class="page">End to end Spring Boot Kabanero workflow</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_prerequisites">Prerequisites</a></li>
<li><a href="#_add_kabanero_collection_to_appsody">Add Kabanero Collection to appsody</a></li>
<li><a href="#_appsody_application">Appsody application</a>
<ul class="sectlevel2">
<li><a href="#_create_a_new_application">Create a new Application</a></li>
<li><a href="#_build_the_application">Build the application</a></li>
<li><a href="#_test_the_application">Test the Application</a></li>
<li><a href="#_run_the_application">Run the Application</a></li>
<li><a href="#_stop_the_application">Stop the Application</a></li>
<li><a href="#_debug_the_application">Debug the Application</a></li>
</ul>
</li>
<li><a href="#_appsody_tasks_on_vs_code">Appsody tasks on VS Code</a></li>
<li><a href="#_codewind_on_vs_code">Codewind on VS Code</a>
<ul class="sectlevel2">
<li><a href="#_getting_the_codewind_extension">Getting the Codewind extension</a></li>
<li><a href="#_adding_the_application">Adding the application</a></li>
<li><a href="#_project_options_for_dev">Project options for dev</a></li>
<li><a href="#_project_options_for_performance">Project options for performance</a></li>
</ul>
</li>
<li><a href="#_deploy_the_appsody_application_on_openshift_for_team_development">Deploy the appsody application on Openshift for team development</a>
<ul class="sectlevel2">
<li><a href="#_set_up_team_project_namespace">Set up team project namespace</a></li>
<li><a href="#_create_application_deployment_manifest">Create application deployment manifest</a></li>
<li><a href="#_creating_a_git_repo">Creating a git repo</a></li>
<li><a href="#_create_an_access_token">Create an access token</a></li>
</ul>
</li>
<li><a href="#_configure_the_devops_pipeline">Configure the DevOps Pipeline</a>
<ul class="sectlevel2">
<li><a href="#_accessing_tekton_dashboard">Accessing Tekton dashboard</a></li>
<li><a href="#_create_tekton_webhook_for_git_repo">Create Tekton webhook for git repo</a></li>
<li><a href="#_set_up_the_pipeline">Set up the pipeline</a></li>
<li><a href="#_deploy_the_application">Deploy the Application</a></li>
</ul>
</li>
<li><a href="#_serverless_autoscaling_the_application_with_knative">Serverless autoscaling the Application with Knative</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://cloud.ibm.com/kubernetes/catalog/openshiftcluster">Openshift Cluster</a></p>
<div class="ulist">
<ul>
<li>
<p>Kabenero Enterprise (Installed with IBM Cloud Pak for Applications)</p>
<div class="ulist">
<ul>
<li>
<p>Tekton Operator and TekTon Dashboard</p>
</li>
<li>
<p>Knative Operator</p>
</li>
</ul>
</div>
</li>
<li>
<p>Install Appsody Operator that watches on all namespaces <a href="https://github.com/appsody/appsody-operator/tree/master/deploy/releases/0.1.0" class="bare">https://github.com/appsody/appsody-operator/tree/master/deploy/releases/0.1.0</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Docker for Desktop - <a href="https://docs.docker.com/docker-for-mac/install/">Mac</a>, <a href="https://docs.docker.com/docker-for-windows/install/">Windows</a></p>
</li>
<li>
<p>The following command line (CLI) tools and configured:</p>
<div class="ulist">
<ul>
<li>
<p>docker - It comes with the Docker for Desktop installation.</p>
</li>
<li>
<p><a href="https://www.okd.io/download.html">oc</a></p>
</li>
<li>
<p><a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git">git</a></p>
</li>
<li>
<p><a href="https://appsody.dev/docs/getting-started/installation">appsody</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_add_kabanero_collection_to_appsody"><a class="anchor" href="#_add_kabanero_collection_to_appsody"></a>Add Kabanero Collection to appsody</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>From the Cloud Pak for Applications landing page get the <code>Collection Hub</code> URL. For example in our example it is as follows.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code><a href="https://github.com/kabanero-io/collections/releases/download/v0.1.2/kabanero-index.yaml" class="bare">https://github.com/kabanero-io/collections/releases/download/v0.1.2/kabanero-index.yaml</a></code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the appsody CLI to add the Collection repo.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody repo add kabanero https://github.com/kabanero-io/collections/releases/download/v0.1.2/kabanero-index.yaml</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If possible, remove other repos that are existing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To get the list of available repos, run this command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody repo list</code></pre>
</div>
</div>
<div class="paragraph">
<p>This returns you something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ appsody repo list

NAME        	URL
*kabanero   	https://github.com/kabanero-io/collections/releases/download/v0.1.2/kabanero-index.yaml
appsodyhub  	https://github.com/appsody/stacks/releases/latest/download/incubator-index.yaml
experimental	https://github.com/appsody/stacks/releases/latest/download/experimental-index.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>To remove the unused repos, run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody repo remove &lt;NAME&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For instance, if you want to remove <code>appsodyhub</code>, then it will be <code>appsody repo remove appsodyhub</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List the appsody stacks available in the Collection:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody list kabanero</code></pre>
</div>
</div>
<div class="paragraph">
<p>It gives you the list of available stacks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ appsody list kabanero

REPO    	ID               	VERSION  	TEMPLATES        	DESCRIPTION
kabanero	java-microprofile	0.2.11   	*default         	Eclipse MicroProfile on Open Liberty &amp; OpenJ9 using Maven
kabanero	java-spring-boot2	0.3.9    	*default, kotlin 	Spring Boot using OpenJ9 and Maven
kabanero	nodejs           	0.2.5    	*simple          	Runtime for Node.js applications
kabanero	nodejs-express   	0.2.5    	*simple, skaffold	Express web framework for Node.js
kabanero	nodejs-loopback  	0.1.4    	*scaffold        	LoopBack 4 API Framework for Node.js</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the <code>kabanero</code> repo as default.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody repo set-default kabanero</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appsody_application"><a class="anchor" href="#_appsody_application"></a>Appsody application</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_create_a_new_application"><a class="anchor" href="#_create_a_new_application"></a>Create a new Application</h3>
<div class="ulist">
<ul>
<li>
<p>Create a new directory for the project and change directory into it.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir appsody_sample_springboot

cd appsody_sample_springboot/</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Initialize the project using <code>appsody init</code> and select the desired stack ID.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody init kabanero/java-spring-boot2</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_the_application"><a class="anchor" href="#_build_the_application"></a>Build the application</h3>
<div class="paragraph">
<p>This command will locally build a docker image of your appsody project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody build</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once it runs successfully, you will see something like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[Docker]  ---&gt; Running in 3edec1263e50
[Docker] Removing intermediate container 3edec1263e50
[Docker]  ---&gt; b738cc92f9e3
[Docker] Step 33/34 : COPY --from=compile /project/user-app/target/app.jar /app.jar
[Docker]  ---&gt; 2bb71966ba32
[Docker] Step 34/34 : ENTRYPOINT [ "sh", "-c", "java $JVM_ARGS -Djava.security.egd=file:/dev/./urandom -jar /app.jar" ]
[Docker]  ---&gt; Running in d9c411bc4772
[Docker] Removing intermediate container d9c411bc4772
[Docker]  ---&gt; 4537506d45ab
[Docker] Successfully built 4537506d45ab
[Docker] Successfully tagged appsody-sample-springboot:latest
Built docker image appsody-sample-springboot</code></pre>
</div>
</div>
<div class="paragraph">
<p>It helps you to check that stack is stable and init is done correctly. You need not run build to run the project ever again.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test_the_application"><a class="anchor" href="#_test_the_application"></a>Test the Application</h3>
<div class="ulist">
<ul>
<li>
<p>Test the application using appsody.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody test</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step is building a container and running the test command inside of it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ appsody test
Running test environment
Running command: docker[pull kabanero/java-spring-boot2:0.3]
Running docker command: docker[run --rm -p 35729:35729 -p 5005:5005 -p 8080:8080 --name appsody-sample-springboot-dev -u 501:20 -e APPSODY_USER=501 -e APPSODY_GROUP=20 -v /Users/user@ibm.com/codewind-workspace/appsody-sample-springboot/.:/project/user-app -v /Users/user@ibm.com/.m2/repository:/mvn/repository -v /Users/user@ibm.com/.appsody/appsody-controller:/appsody/appsody-controller -t --entrypoint /appsody/appsody-controller kabanero/java-spring-boot2:0.3 --mode=test]
[Container] Running: /project/java-spring-boot2-build.sh test
[Container] Installing parent dev.appsody:spring-boot2-stack:0.3.13
[Container] &gt; mvn install -q -f /project/appsody-boot2-pom.xml
[Container] Test project in the foreground
[Container] &gt; mvn package test
[Container] [INFO] Scanning for projects...
...
...
[Container] 2019-09-23 22:25:18.476  INFO 194 --- [           main] i.j.internal.reporters.LoggingReporter   : Span reported: 50797d26c2920f16:50797d26c2920f16:0:1 - GET
[Container] [INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 14.564 s - in application.MainTests
[Container] 2019-09-23 22:25:18.659  INFO 194 --- [      Thread-13] o.s.s.concurrent.ThreadPoolTaskExecutor  : Shutting down ExecutorService 'applicationTaskExecutor'
[Container] [INFO]
[Container] [INFO] Results:
[Container] [INFO]
[Container] [INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0
[Container] [INFO]
[Container] [INFO]
[Container] [INFO] --- maven-jar-plugin:3.1.2:jar (default-jar) @ application ---
[Container] [INFO] Building jar: /project/user-app/target/app.jar
[Container] [INFO]
[Container] [INFO] --- spring-boot-maven-plugin:2.1.6.RELEASE:repackage (default) @ application ---
[Container] [INFO] Replacing main artifact with repackaged archive
[Container] [INFO]
[Container] [INFO] --- maven-resources-plugin:3.1.0:resources (default-resources) @ application ---
[Container] [INFO] Using 'UTF-8' encoding to copy filtered resources.
[Container] [INFO] Copying 2 resources
[Container] [INFO]
[Container] [INFO] --- maven-compiler-plugin:3.8.1:compile (default-compile) @ application ---
[Container] [INFO] Nothing to compile - all classes are up to date
[Container] [INFO]
[Container] [INFO] --- maven-antrun-plugin:1.1:run (trigger-spring-restart) @ application ---
[Container] [INFO] Executing tasks
[Container]      [echo] Triggering Spring app restart.
[Container] [INFO] Executed tasks
[Container] [INFO]
[Container] [INFO] --- maven-resources-plugin:3.1.0:testResources (default-testResources) @ application ---
[Container] [INFO] Using 'UTF-8' encoding to copy filtered resources.
[Container] [INFO] skip non existing resourceDirectory /project/user-app/src/test/resources
[Container] [INFO]
[Container] [INFO] --- maven-compiler-plugin:3.8.1:testCompile (default-testCompile) @ application ---
[Container] [INFO] Nothing to compile - all classes are up to date
[Container] [INFO]
[Container] [INFO] --- maven-surefire-plugin:2.22.2:test (default-test) @ application ---
[Container] [INFO] Skipping execution of surefire because it has already been run for this configuration
[Container] [INFO] ------------------------------------------------------------------------
[Container] [INFO] BUILD SUCCESS
[Container] [INFO] ------------------------------------------------------------------------
[Container] [INFO] Total time:  38.440 s
[Container] [INFO] Finished at: 2019-09-23T22:25:26Z
[Container] [INFO] ------------------------------------------------------------------------
[Container] Watcher is not running.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_the_application"><a class="anchor" href="#_run_the_application"></a>Run the Application</h3>
<div class="ulist">
<ul>
<li>
<p>Run the application using appsody</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody run</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step is building a container and running it, the output has the endpoint for the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Running development environment...
Running command: docker[pull kabanero/java-spring-boot2:0.3]
Running docker command: docker[run --rm -p 5005:5005 -p 8080:8080 -p 35729:35729 --name appsody-sample-springboot-dev -u 501:20 -e APPSODY_USER=501 -e APPSODY_GROUP=20 -v /Users/&lt;user&gt;@ibm.com/kabanero101/appsody_sample_springboot/.:/project/user-app -v /Users/&lt;user&gt;@ibm.com/.m2/repository:/mvn/repository -v /Users/&lt;user&gt;@ibm.com/.appsody/appsody-controller:/appsody/appsody-controller -t --entrypoint /appsody/appsody-controller kabanero/java-spring-boot2:0.3 --mode=run]
......
......
......
[Container] 2019-09-12 17:49:22.173  INFO 185 --- [  restartedMain] o.s.b.a.e.web.EndpointLinksResolver      : Exposing 4 endpoint(s) beneath base path '/actuator'
[Container] 2019-09-12 17:49:22.377  INFO 185 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
[Container] 2019-09-12 17:49:22.386  INFO 185 --- [  restartedMain] application.Main                         : Started Main in 7.984 seconds (JVM running for 9.679)
[Container] 2019-09-12 17:58:42.777  INFO 185 --- [nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
[Container] 2019-09-12 17:58:42.777  INFO 185 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
[Container] 2019-09-12 17:58:42.805  INFO 185 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 27 ms
[Container] 2019-09-12 17:58:43.044  INFO 185 --- [nio-8080-exec-1] i.j.internal.reporters.LoggingReporter   : Span reported: 445d02b19cea491:445d02b19cea491:0:1 - GET</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the application using the web browser at <a href="http://localhost:8080" class="bare">http://localhost:8080</a>.</p>
</li>
<li>
<p>By default, the template provides the below endpoints.</p>
<div class="ulist">
<ul>
<li>
<p>Health endpoint: <a href="http://localhost:8080/actuator/health" class="bare">http://localhost:8080/actuator/health</a></p>
</li>
<li>
<p>Liveness endpoint: <a href="http://localhost:8080/actuator/liveness" class="bare">http://localhost:8080/actuator/liveness</a></p>
</li>
<li>
<p>Metrics endpoint: <a href="http://localhost:8080/actuator/metrics" class="bare">http://localhost:8080/actuator/metrics</a></p>
</li>
<li>
<p>Prometheus endpoint: <a href="http://localhost:8080/actuator/prometheus" class="bare">http://localhost:8080/actuator/prometheus</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details, refer <a href="https://github.com/appsody/stacks/blob/master/incubator/java-spring-boot2/README.md">Spring® Boot 2 Stack</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stop_the_application"><a class="anchor" href="#_stop_the_application"></a>Stop the Application</h3>
<div class="ulist">
<ul>
<li>
<p>To stop the container, run this command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody stop</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Alternatively, you can also press <code>Ctrl+C</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_debug_the_application"><a class="anchor" href="#_debug_the_application"></a>Debug the Application</h3>
<div class="ulist">
<ul>
<li>
<p>Open your editor. We are using VS Code. Add the project to your workspace.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_open_project_vscode.png" alt="sb lab1 open project vscode">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Open a new terminal window inside VS Code. Use <code>View→Terminal</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_open_terminal.png" alt="sb lab1 open terminal">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To debug the application including reloading the application on code changes run the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody debug</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output indicates the debug environment is being used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ appsody debug
Running debug environment
Running command: docker[pull kabanero/java-spring-boot2:0.3]
Running docker command: docker[run --rm -p 35729:35729 -p 5005:5005 -p 8080:8080 --name appsody-sample-springboot-dev -u 501:20 -e APPSODY_USER=501 -e APPSODY_GROUP=20 -v /Users/&lt;user&gt;@ibm.com/kabanero101/appsody_sample_springboot/.:/project/user-app -v /Users/&lt;user&gt;@ibm.com/.m2/repository:/mvn/repository -v /Users/&lt;user&gt;@ibm.com/.appsody/appsody-controller:/appsody/appsody-controller -t --entrypoint /appsody/appsody-controller kabanero/java-spring-boot2:0.3 --mode=debug]
.......
.......
.......
[Container] [INFO] --- maven-compiler-plugin:3.8.1:testCompile (default-testCompile) @ application ---
[Container] [INFO] Changes detected - recompiling the module!
[Container] [INFO] Compiling 1 source file to /project/user-app/target/test-classes
[Container] [INFO]
[Container] [INFO] &lt;&lt;&lt; spring-boot-maven-plugin:2.1.6.RELEASE:run (default-cli) &lt; test-compile @ application &lt;&lt;&lt;
[Container] [INFO]
[Container] [INFO]
[Container] [INFO] --- spring-boot-maven-plugin:2.1.6.RELEASE:run (default-cli) @ application ---
[Container] [INFO] Attaching agents: []
[Container] Listening for transport dt_socket at address: 5005</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Start the debugger in your editor.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_vscode_debugger.png" alt="sb lab1 vscode debugger">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once you start it, you will see something like below.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_vscode_debugger_window.png" alt="sb lab1 vscode debugger window">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Wait till the application starts.</p>
</li>
<li>
<p>Now you can open the application at <a href="http://localhost:8080/" class="bare">http://localhost:8080/</a>.</p>
</li>
<li>
<p>Let us check the liveness probe at <a href="http://localhost:8080/actuator/liveness" class="bare">http://localhost:8080/actuator/liveness</a>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_liveness.png" alt="sb lab1 liveness">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Let us make a code change.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_code_change.png" alt="sb lab1 code change">
</div>
</div>
<div class="paragraph">
<p>Here, the debugger will reload the application for you.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Refresh the browser to see the changes.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_liveness_test.png" alt="sb lab1 liveness test">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Stop the appication usig <code>Ctrl+C</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appsody_tasks_on_vs_code"><a class="anchor" href="#_appsody_tasks_on_vs_code"></a>Appsody tasks on VS Code</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>To access the build tasks on VS code, go to</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Terminal &gt; Run Build Task...</pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_build_task_menu.png" alt="sb lab1 build task menu">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You will see a list of available tasks.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_build_task_list.png" alt="sb lab1 build task list">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <code>Appsody: run</code> and this will run the application.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_build_task_run.png" alt="sb lab1 build task run">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once, it is successfully started, you can access the application at <a href="http://localhost:8080/" class="bare">http://localhost:8080/</a>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_build_task_run_app.png" alt="sb lab1 build task run app">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_codewind_on_vs_code"><a class="anchor" href="#_codewind_on_vs_code"></a>Codewind on VS Code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Codewind simplifies and enhances development in containers by extending industry standard IDEs with features to write, debug, and deploy cloud-native applications. It helps you to get started quickly with templates or samples, or you can also pull in your applications and let Codewind get them cloud ready.</p>
</div>
<div class="paragraph">
<p>Codewind supports VS Code, Eclipse Che, and Eclipse. In this lab, we are using VS Code as our IDE.</p>
</div>
<div class="sect2">
<h3 id="_getting_the_codewind_extension"><a class="anchor" href="#_getting_the_codewind_extension"></a>Getting the Codewind extension</h3>
<div class="ulist">
<ul>
<li>
<p>To get codewind extension you need <a href="https://code.visualstudio.com/download">VS Code version 1.28 or later</a>.</p>
</li>
<li>
<p>Go to the extensions view and install codewind from the VS code market place.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_vscode_codewind_extension.png" alt="sb lab1 vscode codewind extension">
</div>
</div>
<div class="paragraph">
<p>You will find <code>Codewind 0.3.1</code> and click <code>install</code> to get it. Also, if you want to use the IDE for Java applications, you need to install <code>Codewind Java Profiler 19.7.1</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Once you get them installed, let us now open the <code>Codewind</code> in the IDE.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>View &gt; Open View...</pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_vscode_view.png" alt="sb lab1 vscode view">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>It gives you you a list of options. Select <code>Codewind</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_vscode_code_explorer.png" alt="sb lab1 vscode code explorer">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>This opens the <code>Codewind</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_vscode_codewind_explorer.png" alt="sb lab1 vscode codewind explorer">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_the_application"><a class="anchor" href="#_adding_the_application"></a>Adding the application</h3>
<div class="ulist">
<ul>
<li>
<p>You can create a new project or add an existing project to Codewind. Since, we already created one using appsody earlier, let us add the existing project.</p>
</li>
<li>
<p>Right click on <code>Projects</code> under Codewind. Select <code>Add Existing Project</code> in the menu.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_codewind_add_existing_project.png" alt="sb lab1 codewind add existing project">
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong> - Before doing this, copy your project to the codewind workspace. At this point of time, codewind only accepts the projects that are available in the <code>codewind workspace</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>From the codewind workspace, select the project you created earlier.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_add_existing_prj_from_workspace.png" alt="sb lab1 add existing prj from workspace">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The codewind extension asks you for confirmation as follows. Click <code>Yes</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_appsody_extension.png" alt="sb lab1 appsody extension">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The project will be added.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_appsody_project.png" alt="sb lab1 appsody project">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once it is successfully build, it starts running.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_appsody_project_running.png" alt="sb lab1 appsody project running">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_project_options_for_dev"><a class="anchor" href="#_project_options_for_dev"></a>Project options for dev</h3>
<div class="ulist">
<ul>
<li>
<p>Go to the application and <code>right click</code> on it to access the various options available.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_code_wind_project_options.png" alt="sb lab1 code wind project options">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click <code>Open App</code> to access the application.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_codewind_open_app.png" alt="sb lab1 codewind open app">
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong> - Codewind exposes your applications on different external ports. This will allow you to run multiple projects of same type.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To get the overview of your project, click on <code>Open Project Overview</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_codewind_project_overview.png" alt="sb lab1 codewind project overview">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can access the container shell directly from the IDE by using <code>Open Container Shell</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_codewind_container_shell.png" alt="sb lab1 codewind container shell">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To access the logs of the application, click on <code>Show all logs</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_codewind_project_logs.png" alt="sb lab1 codewind project logs">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can also hide the logs if you want to by using <code>Hide all logs</code> option.</p>
</li>
<li>
<p>If you have multiple applications and want to manage the logs for them, you can use <code>Manage logs</code>.</p>
</li>
<li>
<p>You can also run the application by using <code>Restart in Run Mode</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_codewind_project_restart_in_run_mode.png" alt="sb lab1 codewind project restart in run mode">
</div>
</div>
<div class="paragraph">
<p>Once it is restarted, you can access the application by clicking on the button as shown below.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_restart_in_run_mode_app.png" alt="sb lab1 restart in run mode app">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Similarly, you can also do debugging by using <code>Restart in Debug Mode</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_project_options_for_performance"><a class="anchor" href="#_project_options_for_performance"></a>Project options for performance</h3>
<div class="ulist">
<ul>
<li>
<p>Go to the application and <code>right click</code> on it to access the various options available.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_code_wind_project_options.png" alt="sb lab1 code wind project options">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click <code>Open Application Monitor</code> to access the application monitor.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong class="maroon">Enabling Javametrics</strong></p>
</div>
<div class="paragraph">
<p>For Springboot project, you need to set up the Javametrics before accessing the application monitor.</p>
</div>
<div class="paragraph">
<p><strong>Note</strong> - For editing these files, you can use the option <code>Add Folder to Workspace</code> and open it in your VS code editor.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To the sample project you created earlier, add the below annotation.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ComponentScan(basePackages = {"com.ibm.javametrics.spring", "&lt;your_package_name&gt;"})</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the sample application, your main class will be as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package application;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.ComponentScan;

@SpringBootApplication
@ComponentScan(basePackages = {"com.ibm.javametrics.spring", "application"})
public class Main {

	public static void main(String[] args) {
		SpringApplication.run(Main.class, args);
	}

}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the below dependencies to your <code>pom.xml</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.ibm.runtimetools&lt;/groupId&gt;
    &lt;artifactId&gt;javametrics-spring&lt;/artifactId&gt;
    &lt;version&gt;1.4.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.ibm.runtimetools&lt;/groupId&gt;
    &lt;artifactId&gt;javametrics-agent&lt;/artifactId&gt;
    &lt;version&gt;1.4.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.glassfish&lt;/groupId&gt;
    &lt;artifactId&gt;javax.json&lt;/artifactId&gt;
    &lt;version&gt;1.0.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Now, restart your application using the option <code>Restart in Run Mode</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_code_wind_perf_restart_app.png" alt="sb lab1 code wind perf restart app">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once the application is restarted, you can access the application monitor and performance dashboard.</p>
</li>
<li>
<p>Click on the <code>Open Application Monitor</code> to access the java metrics dashboard.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_code_wind_perf_app_monitor.png" alt="sb lab1 code wind perf app monitor">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_code_wind_perf_app_monitor_summary.png" alt="sb lab1 code wind perf app monitor summary">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To open the performance dashboard, click on <code>Open Performance Dashboard</code>.</p>
<div class="ulist">
<ul>
<li>
<p>Access the dashboard and then run the test.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_code_wind_perf_dashboard.png" alt="sb lab1 code wind perf dashboard">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a load test as follows. Then refresh your application to create load.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_code_wind_perf_load_test_create.png" alt="sb lab1 code wind perf load test create">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Run the test.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_code_wind_perf_load_test_run.png" alt="sb lab1 code wind perf load test run">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You will see something like below after the first test.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_code_wind_perf_load_test_one.png" alt="sb lab1 code wind perf load test one">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Run couple of tests and you should be able to see the results.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_code_wind_perf_load_test_two.png" alt="sb lab1 code wind perf load test two">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_code_wind_perf_load_test_four.png" alt="sb lab1 code wind perf load test four">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If you scroll down, you can also see the test history details.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_code_wind_perf_load_test_history.png" alt="sb lab1 code wind perf load test history">
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong> - In codewind, for now the <code>Application Monitor</code> and <code>Performance Dashboard</code> shows up on first run. It does not load the metrics if you reload the dashboard.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploy_the_appsody_application_on_openshift_for_team_development"><a class="anchor" href="#_deploy_the_appsody_application_on_openshift_for_team_development"></a>Deploy the appsody application on Openshift for team development</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_set_up_team_project_namespace"><a class="anchor" href="#_set_up_team_project_namespace"></a>Set up team project namespace</h3>
<div class="ulist">
<ul>
<li>
<p>Create a new project for your team if it does not exist. Or if you have an existing project, skip this step.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc new-project &lt;yournamespace&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you create it, you will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc new-project kabanero-samples-java
Already on project "kabanero-samples-java" on server "https://c100-e.us-east.containers.cloud.ibm.com:31718".

You can add applications to this project with the 'new-app' command. For example, try:

    oc new-app centos/ruby-25-centos7~https://github.com/sclorg/ruby-ex.git

to build a new example application in Ruby.</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Switch to the target project using the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project &lt;yournamespace&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It gives you the below message if you are already in that space.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc project kabanero-samples-java
Already on project "kabanero-samples-java" on server "https://c100-e.us-east.containers.cloud.ibm.com:31718".</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Check that the current context is your team&#8217;s project space.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project -q</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc project -q
kabanero-samples-java</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_application_deployment_manifest"><a class="anchor" href="#_create_application_deployment_manifest"></a>Create application deployment manifest</h3>
<div class="ulist">
<ul>
<li>
<p>Extract the appsody deployment config.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">appsody deploy --generate-only</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will generate you the below file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: appsody.dev/v1beta1
kind: AppsodyApplication
metadata:
  name: appsody-sample-springboot
spec:
  # Add fields here
  version: 1.0.0
  applicationImage: appsody-sample-springboot
  stack: java-spring-boot2
  service:
    type: NodePort
    port: 8080
    annotations:
      prometheus.io/scrape: 'true'
      prometheus.io/path: '/actuator/prometheus'
  readinessProbe:
    failureThreshold: 12
    httpGet:
      path: /actuator/health
      port: 8080
    initialDelaySeconds: 5
    periodSeconds: 2
  livenessProbe:
    failureThreshold: 12
    httpGet:
      path: /actuator/liveness
      port: 8080
    initialDelaySeconds: 5
    periodSeconds: 2
  expose: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the application is deployed in the <code>kabanero</code> namespace. If you want to deploy the application in a different namespace, you can specify it in this yaml file. In this lab, let us use a namespace called <code>kabanero-samples-java</code> and we can specify it under the metadata as below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: appsody.dev/v1beta1
kind: AppsodyApplication
metadata:
  name: appsody-sample-springboot
  namespace: kabanero-samples-java
spec:
  # Add fields here
  version: 1.0.0
  applicationImage: appsody-sample-springboot
  stack: java-spring-boot2
  service:
    type: NodePort
    port: 8080
    annotations:
      prometheus.io/scrape: 'true'
      prometheus.io/path: '/actuator/prometheus'
  readinessProbe:
    failureThreshold: 12
    httpGet:
      path: /actuator/health
      port: 8080
    initialDelaySeconds: 5
    periodSeconds: 2
  livenessProbe:
    failureThreshold: 12
    httpGet:
      path: /actuator/liveness
      port: 8080
    initialDelaySeconds: 5
    periodSeconds: 2
  expose: true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_git_repo"><a class="anchor" href="#_creating_a_git_repo"></a>Creating a git repo</h3>
<div class="ulist">
<ul>
<li>
<p>Setup your git locally with the content of the application.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git init
git add .
git commit -m "initial commit"</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a github repository and push the code to the remote repository.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git remote add origin $GITHUB_REPOSITORY_URL
git push -u origin master</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_an_access_token"><a class="anchor" href="#_create_an_access_token"></a>Create an access token</h3>
<div class="ulist">
<ul>
<li>
<p>Go to Github <code>Settings</code>.</p>
</li>
<li>
<p>Select <code>Developer settings</code>.</p>
</li>
<li>
<p>Click on <code>Personal access tokens</code>.</p>
</li>
<li>
<p>Select <code>Generate new token</code>.</p>
</li>
<li>
<p>Create a Github access token with permission <code>admin:repo_hook</code></p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_github_token.png" alt="sb lab1 github token">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Then finally click <code>Generate token</code> to create one.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details on how to generate Github personal access token refer <a href="https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line">Creating a personal access token</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configure_the_devops_pipeline"><a class="anchor" href="#_configure_the_devops_pipeline"></a>Configure the DevOps Pipeline</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_accessing_tekton_dashboard"><a class="anchor" href="#_accessing_tekton_dashboard"></a>Accessing Tekton dashboard</h3>
<div class="ulist">
<ul>
<li>
<p>To access the Tekton Dashboard, run the below command.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get route -n kabanero
NAME               HOST/PORT                                                                                                          PATH      SERVICES           PORT      TERMINATION          WILDCARD
icpa-landing       ibm-cp-applications.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud                   icpa-landing       &lt;all&gt;     reencrypt/Redirect   None
kabanero-cli       kabanero-cli-kabanero.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud                 kabanero-cli       &lt;all&gt;     passthrough          None
kabanero-landing   kabanero-landing-kabanero.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud             kabanero-landing   &lt;all&gt;     passthrough          None
tekton-dashboard   tekton-dashboard-kabanero.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud             tekton-dashboard   &lt;all&gt;     reencrypt/Redirect   None</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can access it at the <code>HOST/PORT</code> available. For instance here it will be <code>tekton-dashboard-kabanero.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can also access it on the Cloud Pak Landing page. You will find a <code>Tekton Dashboard</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_kabanero_enterprise.png" alt="sb lab1 kabanero enterprise">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_kabanero_ent_dashboard.png" alt="sb lab1 kabanero ent dashboard">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_kabanero_ent_instance.png" alt="sb lab1 kabanero ent instance">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_tekton_dashboard.png" alt="sb lab1 tekton dashboard">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_tekton_webhook_for_git_repo"><a class="anchor" href="#_create_tekton_webhook_for_git_repo"></a>Create Tekton webhook for git repo</h3>
<div class="ulist">
<ul>
<li>
<p>Click on Webhooks in the menu.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_menu_webhooks.png" alt="sb lab1 menu webhooks">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <code>Add Webhook</code>.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_add_webhook.png" alt="sb lab1 add webhook">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter the information for the Webhook settings.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_webhook_settings.png" alt="sb lab1 webhook settings">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Name - &lt;Name for webhook&gt;
Repository URL - &lt;Your github repository URL&gt;
Access Token - &lt;For this, you need to create a Github access token with permission `admin:repo_hook` or select one from the list&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new token as follows.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_webhook_settings_access_token_create.png" alt="sb lab1 webhook settings access token create">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can also use an existing token if it is already created.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_webhook_settings_access_token_existing.png" alt="sb lab1 webhook settings access token existing">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_set_up_the_pipeline"><a class="anchor" href="#_set_up_the_pipeline"></a>Set up the pipeline</h3>
<div class="ulist">
<ul>
<li>
<p>Enter the information for the Pipeline settings</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Namespace - kabanero
Pipeline - java-spring-boot2-build-deploy-pipeline
Service account - kabaner-operator
Docker Registry - docker-registry.default.svc:5000/&lt;your_project&gt;</pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_pipeline_settings.png" alt="sb lab1 pipeline settings">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click Create, a new webhook is created.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_webhook.png" alt="sb lab1 webhook">
</div>
</div>
<div class="paragraph">
<p>Also, a new Gitub webhook is created on the project repository.</p>
</div>
<div class="paragraph">
<p>You can verify it by going into your <code>github repository &gt; Settings &gt; Webhooks</code> and you should be able to see the webhook created.</p>
</div>
<div class="paragraph">
<p><strong>[Issue]</strong> The webhook may show an error of 503. It will be cleared the first time the github webhook gets triggered.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_the_application"><a class="anchor" href="#_deploy_the_application"></a>Deploy the Application</h3>
<div class="paragraph">
<p>The way to deploy the application is to make a change in the application in the git repository to trigger the tekton webhook and start the DevOps pipeline to build and deploy the application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make a change to the application such as changing the <code>index.html</code> or any other things.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let us change the <code>title</code> from <code>Hello from Appsody!</code> to <code>Hello from Cloud Paks !!!</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Push your changes to the remote git repository.</p>
</li>
<li>
<p>This will trigger the Tekton Pipeline. To see the status of the Pipeline click on <code>PipelineRuns</code> on the menu of the dashboard.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_pipeline_runs.png" alt="sb lab1 pipeline runs">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>When the application is built and deployed the application will be available via the expose <code>Route</code>.</p>
</li>
<li>
<p>Go to the OpenShift Console, switch to the project, and select <code>Applications &gt; Routes</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will see a route for your application, click on the url to open your application.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../_images/sb_lab1_application_route.png" alt="sb lab1 application route">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Or you can also get the route from the oc CLI.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get route -n &lt;your_project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For instance,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get routes -n kabanero-samples-java
NAME                        HOST/PORT                                                                                                                                PATH      SERVICES                    PORT      TERMINATION   WILDCARD
appsody-sample-springboot   appsody-sample-springboot-kabanero-samples-java.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud             appsody-sample-springboot   8080                    None</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now acccess the application at &lt;HOST/PORT&gt;, here it is <code>appsody-sample-springboot-kabanero-samples-java.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serverless_autoscaling_the_application_with_knative"><a class="anchor" href="#_serverless_autoscaling_the_application_with_knative"></a>Serverless autoscaling the Application with Knative</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Edit the file <code>app-deploy.yaml</code>.</p>
</li>
<li>
<p>Add the line <code>createKnativeService: true</code> to the spec object.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: appsody.dev/v1beta1
kind: AppsodyApplication
metadata:
  name: appsody-sample-springboot
  namespace: kabanero-samples
spec:
  version: 1.0.0
  applicationImage: appsody-sample-springboot
  stack: java-spring-boot2
  createKnativeService: true</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Git push the change, and see tekton pipeline runs again.</p>
</li>
<li>
<p>Show the Knative resource.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get service.serving.knative.dev/appsody-sample-springboot
NAME                        URL                                                                                                                                        LATESTCREATED                     LATESTREADY                       READY     REASON
appsody-sample-springboot   http://appsody-sample-springboot.kabanero-samples.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud   appsody-sample-springboot-cbq47   appsody-sample-springboot-cbq47   True</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Show the Knative route.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get route.serving.knative.dev/appsody-sample-springboot
NAME                        URL                                                                                                                                        READY     REASON
appsody-sample-springboot   http://appsody-sample-springboot.kabanero-samples.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud   True</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Show the Knative configuration.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get configuration.serving.knative.dev/appsody-sample-springboot
NAME                        LATESTCREATED                     LATESTREADY                       READY     REASON
appsody-sample-springboot   appsody-sample-springboot-cbq47   appsody-sample-springboot-cbq47   True</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Show the Knative latest ready revision.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get revision.serving.knative.dev/appsody-sample-springboot-cbq47
NAME                              SERVICE NAME                      GENERATION   READY     REASON
appsody-sample-springboot-cbq47   appsody-sample-springboot-cbq47   2            True</code></pre>
</div>
</div>
<div class="paragraph">
<p>Visit the Knative public url <a href="http://appsody-sample-springboot.kabanero-samples.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud" class="bare">http://appsody-sample-springboot.kabanero-samples.csantana-ocp3-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud</a> and list the pods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get pods

NAME                                                          READY     STATUS    RESTARTS   AGE
appsody-sample-springboot-cbq47-deployment-7dd6b4d559-phmv7   2/2       Running   0          1m</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Wait 1 minute and you will the see the pods are not longer running</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get pods

No resources found.</code></pre>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
